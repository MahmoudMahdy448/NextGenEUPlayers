[0m04:50:13.218408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b012006d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b010772e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b000e82b0>]}


============================== 04:50:13.223568 | b7deb886-db19-4fcf-ac75-f8703731a5a1 ==============================
[0m04:50:13.223568 [info ] [MainThread]: Running with dbt=1.10.15
[0m04:50:13.224197 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt deps', 'empty': 'None', 'log_path': '/app/transformation/logs', 'use_colors': 'True', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'no_print': 'None', 'printer_width': '80', 'debug': 'False', 'fail_fast': 'False', 'quiet': 'False', 'static_parser': 'True', 'profiles_dir': '/app/transformation', 'write_json': 'True'}
[0m04:50:13.367868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7deb886-db19-4fcf-ac75-f8703731a5a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b000e9120>]}
[0m04:50:13.381408 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-vg4g_vac'
[0m04:50:13.381953 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m04:50:13.430710 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m04:50:13.432140 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m04:50:13.472969 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m04:50:13.488014 [info ] [MainThread]: Updating lock file in file path: /app/transformation/package-lock.yml
[0m04:50:13.490475 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-kray4k_2'
[0m04:50:13.494800 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m04:50:13.716371 [info ] [MainThread]: Installed from version 1.1.1
[0m04:50:13.717018 [info ] [MainThread]: Updated version available: 1.3.2
[0m04:50:13.717596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'b7deb886-db19-4fcf-ac75-f8703731a5a1', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b02fc1360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4afff63490>]}
[0m04:50:13.718138 [info ] [MainThread]: 
[0m04:50:13.718646 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m04:50:13.720266 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.5631116, "process_in_blocks": "22592", "process_kernel_time": 0.188878, "process_mem_max_rss": "102516", "process_out_blocks": "2240", "process_user_time": 2.015703}
[0m04:50:13.720971 [debug] [MainThread]: Command `dbt deps` succeeded at 04:50:13.720832 after 0.56 seconds
[0m04:50:13.721444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b012006d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b02fc1360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d4b000e8bb0>]}
[0m04:50:13.721951 [debug] [MainThread]: Flushing usage events
[0m04:50:14.110997 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:50:24.978963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76beed9706d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76beec871690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76beec872cb0>]}


============================== 04:50:24.984077 | 4b11f203-533c-45db-ba41-b5663d89cbbc ==============================
[0m04:50:24.984077 [info ] [MainThread]: Running with dbt=1.10.15
[0m04:50:24.984758 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'warn_error': 'None', 'use_colors': 'True', 'introspect': 'True', 'no_print': 'None', 'target_path': 'None', 'cache_selected_only': 'False', 'log_path': '/app/transformation/logs', 'log_format': 'default', 'write_json': 'True', 'partial_parse': 'True', 'printer_width': '80', 'profiles_dir': '/app/transformation', 'fail_fast': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --select stg_fbref__standard', 'empty': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False'}
[0m04:50:25.236999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4b11f203-533c-45db-ba41-b5663d89cbbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76beefc2ce50>]}
[0m04:50:25.307425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4b11f203-533c-45db-ba41-b5663d89cbbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76beecb322f0>]}
[0m04:50:25.309316 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m04:50:25.414943 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m04:50:25.415885 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m04:50:25.416374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4b11f203-533c-45db-ba41-b5663d89cbbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76bee6c86950>]}
[0m04:50:27.038282 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.nextgeneu_players.marts
[0m04:50:27.050841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4b11f203-533c-45db-ba41-b5663d89cbbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76bee5e699f0>]}
[0m04:50:27.229461 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m04:50:27.231611 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m04:50:27.248499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4b11f203-533c-45db-ba41-b5663d89cbbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76bee8ecd660>]}
[0m04:50:27.249163 [info ] [MainThread]: Found 1 model, 33 sources, 586 macros
[0m04:50:27.249574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b11f203-533c-45db-ba41-b5663d89cbbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76bee8ece380>]}
[0m04:50:27.251139 [info ] [MainThread]: 
[0m04:50:27.251572 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:50:27.251975 [info ] [MainThread]: 
[0m04:50:27.252651 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m04:50:27.253647 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_players'
[0m04:50:27.297103 [debug] [ThreadPool]: Using duckdb connection "list_players"
[0m04:50:27.297601 [debug] [ThreadPool]: On list_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"players"'
    
  
  
[0m04:50:27.297948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:50:27.305634 [debug] [ThreadPool]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"players"'
    
  
  
[0m04:50:27.306061 [debug] [ThreadPool]: DuckDB adapter: Rolling back transaction.
[0m04:50:27.306940 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:50:27.307329 [debug] [MainThread]: Connection 'list_players' was properly closed.
[0m04:50:27.307765 [info ] [MainThread]: 
[0m04:50:27.308256 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.06 seconds (0.06s).
[0m04:50:27.308928 [error] [MainThread]: Encountered an error:
Runtime Error
  IO Error: Could not set lock on file "/app/data/duckdb/players.db": Conflicting lock is held in PID 0. However, you would be able to open this database in read-only mode, e.g. by using the -readonly parameter in the CLI. See also https://duckdb.org/docs/stable/connect/concurrency
[0m04:50:27.310015 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.3983612, "process_in_blocks": "9608", "process_kernel_time": 0.218056, "process_mem_max_rss": "159444", "process_out_blocks": "2640", "process_user_time": 3.96303}
[0m04:50:27.310555 [debug] [MainThread]: Command `dbt run` failed at 04:50:27.310427 after 2.40 seconds
[0m04:50:27.311002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76bee8ecc1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76bee8ecf010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76bee690f6d0>]}
[0m04:50:27.311515 [debug] [MainThread]: Flushing usage events
[0m04:50:27.732276 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:50:49.422514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616ff606d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616ee45690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616ee46cb0>]}


============================== 04:50:49.427664 | 55ac068d-d4fe-4ac3-951c-a4d52b74f47d ==============================
[0m04:50:49.427664 [info ] [MainThread]: Running with dbt=1.10.15
[0m04:50:49.428268 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'profiles_dir': '/app/transformation', 'invocation_command': 'dbt run --select stg_fbref__standard', 'fail_fast': 'False', 'static_parser': 'True', 'quiet': 'False', 'empty': 'False', 'target_path': 'None', 'introspect': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error': 'None', 'write_json': 'True', 'log_path': '/app/transformation/logs', 'log_cache_events': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'partial_parse': 'True'}
[0m04:50:49.683640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55ac068d-d4fe-4ac3-951c-a4d52b74f47d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7761721f8e50>]}
[0m04:50:49.759349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55ac068d-d4fe-4ac3-951c-a4d52b74f47d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616f0e22f0>]}
[0m04:50:49.761272 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m04:50:49.853360 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m04:50:49.981822 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:50:49.982412 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:50:49.989959 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.nextgeneu_players.marts
[0m04:50:50.026511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55ac068d-d4fe-4ac3-951c-a4d52b74f47d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776168e88130>]}
[0m04:50:50.172495 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m04:50:50.174474 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m04:50:50.191190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55ac068d-d4fe-4ac3-951c-a4d52b74f47d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776168e9f4f0>]}
[0m04:50:50.191685 [info ] [MainThread]: Found 1 model, 33 sources, 586 macros
[0m04:50:50.192100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55ac068d-d4fe-4ac3-951c-a4d52b74f47d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776168ec4c70>]}
[0m04:50:50.193686 [info ] [MainThread]: 
[0m04:50:50.194143 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:50:50.194511 [info ] [MainThread]: 
[0m04:50:50.195121 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m04:50:50.195997 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_players'
[0m04:50:50.234651 [debug] [ThreadPool]: Using duckdb connection "list_players"
[0m04:50:50.235074 [debug] [ThreadPool]: On list_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"players"'
    
  
  
[0m04:50:50.235411 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:50:50.263561 [debug] [ThreadPool]: SQL status: OK in 0.028 seconds
[0m04:50:50.264980 [debug] [ThreadPool]: On list_players: Close
[0m04:50:50.265720 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_players, now create_players_main)
[0m04:50:50.266232 [debug] [ThreadPool]: Creating schema "database: "players"
schema: "main"
"
[0m04:50:50.274018 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:50:50.274381 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='players'
        and type='sqlite'
    
  
[0m04:50:50.274683 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:50:50.275535 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m04:50:50.276709 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:50:50.277029 [debug] [ThreadPool]: On create_players_main: BEGIN
[0m04:50:50.277614 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:50:50.277923 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:50:50.278259 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
    
        create schema if not exists "players"."main"
    
[0m04:50:50.278790 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:50:50.279615 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m04:50:50.280046 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:50:50.280500 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m04:50:50.281207 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:50:50.281605 [debug] [ThreadPool]: On create_players_main: Close
[0m04:50:50.282658 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_players_main, now list_players_main)
[0m04:50:50.288588 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m04:50:50.288908 [debug] [ThreadPool]: On list_players_main: BEGIN
[0m04:50:50.289196 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:50:50.289741 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m04:50:50.290041 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m04:50:50.290413 [debug] [ThreadPool]: On list_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players_main"} */
select
      'players' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'players'
  
[0m04:50:50.302417 [debug] [ThreadPool]: SQL status: OK in 0.012 seconds
[0m04:50:50.303539 [debug] [ThreadPool]: On list_players_main: ROLLBACK
[0m04:50:50.304056 [debug] [ThreadPool]: Failed to rollback 'list_players_main'
[0m04:50:50.304386 [debug] [ThreadPool]: On list_players_main: Close
[0m04:50:50.304930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55ac068d-d4fe-4ac3-951c-a4d52b74f47d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616edbcbb0>]}
[0m04:50:50.305454 [debug] [MainThread]: Using duckdb connection "master"
[0m04:50:50.305773 [debug] [MainThread]: On master: BEGIN
[0m04:50:50.306069 [debug] [MainThread]: Opening a new connection, currently in state init
[0m04:50:50.306732 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m04:50:50.307054 [debug] [MainThread]: On master: COMMIT
[0m04:50:50.307397 [debug] [MainThread]: Using duckdb connection "master"
[0m04:50:50.307704 [debug] [MainThread]: On master: COMMIT
[0m04:50:50.308211 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m04:50:50.308540 [debug] [MainThread]: On master: Close
[0m04:50:50.311562 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__standard
[0m04:50:50.312247 [info ] [Thread-1 (]: 1 of 1 START sql view model main.stg_fbref__standard ........................... [RUN]
[0m04:50:50.312776 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_players_main, now model.nextgeneu_players.stg_fbref__standard)
[0m04:50:50.313186 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__standard
[0m04:50:50.328496 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__standard"
[0m04:50:50.329410 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__standard
[0m04:50:50.366807 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__standard"
[0m04:50:50.367771 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:50:50.368174 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: BEGIN
[0m04:50:50.368534 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:50:50.369433 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:50:50.369813 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:50:50.370291 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

  
  create view "players"."main"."stg_fbref__standard__dbt_tmp" as (
    -- 1. CONFIGURATION


WITH raw_union AS (
    
        SELECT 
            *, 
            '2023_2024' as source_season_id 
        FROM "players"."raw"."standard_stats_2023_2024"
         UNION ALL 
    
        SELECT 
            *, 
            '2024_2025' as source_season_id 
        FROM "players"."raw"."standard_stats_2024_2025"
         UNION ALL 
    
        SELECT 
            *, 
            '2025_2026' as source_season_id 
        FROM "players"."raw"."standard_stats_2025_2026"
        
    
),

cleaned AS (
    SELECT
        -- 1. IDENTITY (The Golden Key)
        
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
        
        -- 2. METADATA
        unnamed_1_level_0_player as player_name,
        unnamed_2_level_0_nation as nation,
        unnamed_4_level_0_squad  as squad,
        unnamed_3_level_0_pos    as primary_position,
        unnamed_5_level_0_comp   as competition,
        source_season_id         as season_id,
        
        -- 3. DEMOGRAPHICS
        
    TRY_CAST(SPLIT_PART(unnamed_6_level_0_age, '-', 1) AS INTEGER)
 as age,
        
    TRY_CAST(REPLACE(unnamed_7_level_0_born, ',', '') AS INTEGER)
 as birth_year,

        -- 4. PLAYING TIME
        
    TRY_CAST(REPLACE(playing_time_mp, ',', '') AS INTEGER)
 as matches_played,
        
    TRY_CAST(REPLACE(playing_time_starts, ',', '') AS INTEGER)
 as matches_started,
        
    TRY_CAST(REPLACE(playing_time_min, ',', '') AS INTEGER)
 as minutes_played,
        TRY_CAST(playing_time_90s AS FLOAT) as minutes_90s,

        -- 5. PERFORMANCE METRICS (Using the macro to handle commas/types)
        
    TRY_CAST(REPLACE(performance_gls, ',', '') AS INTEGER)
 as goals,
        
    TRY_CAST(REPLACE(performance_ast, ',', '') AS INTEGER)
 as assists,
        
    TRY_CAST(REPLACE(performance_ga, ',', '') AS INTEGER)
 as goals_assists,
        
    TRY_CAST(REPLACE(performance_pk, ',', '') AS INTEGER)
 as penalties_made,
        
    TRY_CAST(REPLACE(performance_pkatt, ',', '') AS INTEGER)
 as penalties_att,
        
        -- 6. EXPECTED METRICS
        TRY_CAST(expected_xg AS FLOAT) as xg,
        TRY_CAST(expected_npxg AS FLOAT) as npxg,
        TRY_CAST(expected_xag AS FLOAT) as xag,
        
        -- 7. PROGRESSION
        
    TRY_CAST(REPLACE(progression_prgc, ',', '') AS INTEGER)
 as progressive_carries,
        
    TRY_CAST(REPLACE(progression_prgp, ',', '') AS INTEGER)
 as progressive_passes,
        
    TRY_CAST(REPLACE(progression_prgr, ',', '') AS INTEGER)
 as progressive_receptions

    FROM raw_union
)

SELECT * FROM cleaned
WHERE player_name != 'Player' -- Filter header rows
  AND player_name IS NOT NULL
  );

[0m04:50:50.372617 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:50:50.378964 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:50:50.379391 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */
alter view "players"."main"."stg_fbref__standard__dbt_tmp" rename to "stg_fbref__standard"
[0m04:50:50.380145 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:50:50.389844 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m04:50:50.390260 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:50:50.390626 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m04:50:50.402981 [debug] [Thread-1 (]: SQL status: OK in 0.012 seconds
[0m04:50:50.409553 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:50:50.410064 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

      drop view if exists "players"."main"."stg_fbref__standard__dbt_backup" cascade
    
[0m04:50:50.411056 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:50:50.413828 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: Close
[0m04:50:50.415653 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55ac068d-d4fe-4ac3-951c-a4d52b74f47d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776168e9da80>]}
[0m04:50:50.416377 [info ] [Thread-1 (]: 1 of 1 OK created sql view model main.stg_fbref__standard ...................... [[32mOK[0m in 0.10s]
[0m04:50:50.417170 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__standard
[0m04:50:50.418309 [debug] [MainThread]: Using duckdb connection "master"
[0m04:50:50.418631 [debug] [MainThread]: On master: BEGIN
[0m04:50:50.418927 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m04:50:50.419645 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m04:50:50.419979 [debug] [MainThread]: On master: COMMIT
[0m04:50:50.420350 [debug] [MainThread]: Using duckdb connection "master"
[0m04:50:50.420663 [debug] [MainThread]: On master: COMMIT
[0m04:50:50.421176 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m04:50:50.421508 [debug] [MainThread]: On master: Close
[0m04:50:50.421917 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:50:50.422324 [debug] [MainThread]: Connection 'model.nextgeneu_players.stg_fbref__standard' was properly closed.
[0m04:50:50.422687 [info ] [MainThread]: 
[0m04:50:50.423111 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m04:50:50.424012 [debug] [MainThread]: Command end result
[0m04:50:50.459988 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m04:50:50.461959 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m04:50:50.468932 [debug] [MainThread]: Wrote artifact RunExecutionResult to /app/transformation/target/run_results.json
[0m04:50:50.469282 [info ] [MainThread]: 
[0m04:50:50.469782 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:50:50.470232 [info ] [MainThread]: 
[0m04:50:50.470708 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m04:50:50.471708 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1128616, "process_in_blocks": "128", "process_kernel_time": 0.192879, "process_mem_max_rss": "166348", "process_out_blocks": "2752", "process_user_time": 2.688325}
[0m04:50:50.472275 [debug] [MainThread]: Command `dbt run` succeeded at 04:50:50.472149 after 1.11 seconds
[0m04:50:50.472675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616ff606d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616fe136d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77616f6f28f0>]}
[0m04:50:50.473079 [debug] [MainThread]: Flushing usage events
[0m04:50:50.863787 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:54:44.666731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314db324700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314da215690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314da216cb0>]}


============================== 04:54:44.671824 | 2b00efeb-c9ed-4742-ac6d-b0c72e21feb5 ==============================
[0m04:54:44.671824 [info ] [MainThread]: Running with dbt=1.10.15
[0m04:54:44.672500 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'introspect': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'write_json': 'True', 'empty': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'log_format': 'default', 'static_parser': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'no_print': 'None', 'printer_width': '80', 'log_cache_events': 'False', 'profiles_dir': '/app/transformation', 'warn_error': 'None', 'log_path': '/app/transformation/logs'}
[0m04:54:44.940066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314dd0e5360>]}
[0m04:54:45.010387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314da1f3d90>]}
[0m04:54:45.012268 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m04:54:45.106400 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m04:54:45.229261 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 8 files added, 0 files changed.
[0m04:54:45.229870 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/staging/distribution/stg_fbref__passing.sql
[0m04:54:45.230262 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/staging/distribution/stg_fbref__possession.sql
[0m04:54:45.230661 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/staging/defense/stg_fbref__defense.sql
[0m04:54:45.231017 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/staging/attack/stg_fbref__shooting.sql
[0m04:54:45.231394 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/intermediate/int_player_season_stats.sql
[0m04:54:45.231740 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/staging/general/stg_fbref__misc.sql
[0m04:54:45.232095 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/staging/attack/stg_fbref__creation.sql
[0m04:54:45.232444 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/staging/general/stg_fbref__playing_time.sql
[0m04:54:45.617150 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.nextgeneu_players.marts
[0m04:54:45.634344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d3979de0>]}
[0m04:54:45.734177 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m04:54:45.736242 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m04:54:45.753290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d302e6e0>]}
[0m04:54:45.753802 [info ] [MainThread]: Found 9 models, 33 sources, 586 macros
[0m04:54:45.754243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d302e740>]}
[0m04:54:45.756533 [info ] [MainThread]: 
[0m04:54:45.756990 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:54:45.757425 [info ] [MainThread]: 
[0m04:54:45.758150 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m04:54:45.765924 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_players'
[0m04:54:45.806409 [debug] [ThreadPool]: Using duckdb connection "list_players"
[0m04:54:45.806890 [debug] [ThreadPool]: On list_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"players"'
    
  
  
[0m04:54:45.807238 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:54:45.834465 [debug] [ThreadPool]: SQL status: OK in 0.027 seconds
[0m04:54:45.836000 [debug] [ThreadPool]: On list_players: Close
[0m04:54:45.837063 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_players, now create_players_main)
[0m04:54:45.837666 [debug] [ThreadPool]: Creating schema "database: "players"
schema: "main"
"
[0m04:54:45.845828 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:54:45.846186 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='players'
        and type='sqlite'
    
  
[0m04:54:45.846478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:54:45.847646 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m04:54:45.848907 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:54:45.849289 [debug] [ThreadPool]: On create_players_main: BEGIN
[0m04:54:45.849878 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:54:45.850235 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:54:45.850562 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
    
        create schema if not exists "players"."main"
    
[0m04:54:45.851161 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:54:45.851995 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m04:54:45.852389 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:54:45.852702 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m04:54:45.853234 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:54:45.853572 [debug] [ThreadPool]: On create_players_main: Close
[0m04:54:45.855200 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_players_main, now list_players_main)
[0m04:54:45.860972 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m04:54:45.861334 [debug] [ThreadPool]: On list_players_main: BEGIN
[0m04:54:45.861634 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:54:45.862267 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m04:54:45.862593 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m04:54:45.862940 [debug] [ThreadPool]: On list_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players_main"} */
select
      'players' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'players'
  
[0m04:54:45.874216 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m04:54:45.875416 [debug] [ThreadPool]: On list_players_main: ROLLBACK
[0m04:54:45.875933 [debug] [ThreadPool]: Failed to rollback 'list_players_main'
[0m04:54:45.876248 [debug] [ThreadPool]: On list_players_main: Close
[0m04:54:45.877045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d4183580>]}
[0m04:54:45.877562 [debug] [MainThread]: Using duckdb connection "master"
[0m04:54:45.877885 [debug] [MainThread]: On master: BEGIN
[0m04:54:45.878206 [debug] [MainThread]: Opening a new connection, currently in state init
[0m04:54:45.878770 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m04:54:45.879111 [debug] [MainThread]: On master: COMMIT
[0m04:54:45.879431 [debug] [MainThread]: Using duckdb connection "master"
[0m04:54:45.879732 [debug] [MainThread]: On master: COMMIT
[0m04:54:45.880263 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m04:54:45.880612 [debug] [MainThread]: On master: Close
[0m04:54:45.883725 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__creation
[0m04:54:45.884277 [info ] [Thread-1 (]: 1 of 9 START sql view model main.stg_fbref__creation ........................... [RUN]
[0m04:54:45.884807 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_players_main, now model.nextgeneu_players.stg_fbref__creation)
[0m04:54:45.885215 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__creation
[0m04:54:45.896072 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__creation"
[0m04:54:45.896754 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__creation
[0m04:54:45.928813 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__creation"
[0m04:54:45.929724 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m04:54:45.930149 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: BEGIN
[0m04:54:45.930520 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:45.931483 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:45.931869 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m04:54:45.932303 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */

  
  create view "players"."main"."stg_fbref__creation__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(sca_sca, ',', '') AS INTEGER)
 as shot_creating_actions,
    
    TRY_CAST(REPLACE(gca_gca, ',', '') AS INTEGER)
 as goal_creating_actions

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m04:54:45.933800 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:45.940295 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m04:54:45.940699 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */
alter view "players"."main"."stg_fbref__creation__dbt_tmp" rename to "stg_fbref__creation"
[0m04:54:45.941475 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:45.951979 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: COMMIT
[0m04:54:45.952403 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m04:54:45.952761 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: COMMIT
[0m04:54:45.971958 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m04:54:45.978663 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m04:54:45.979116 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */

      drop view if exists "players"."main"."stg_fbref__creation__dbt_backup" cascade
    
[0m04:54:45.979813 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:45.982396 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: Close
[0m04:54:45.984119 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d25b12a0>]}
[0m04:54:45.984779 [info ] [Thread-1 (]: 1 of 9 OK created sql view model main.stg_fbref__creation ...................... [[32mOK[0m in 0.10s]
[0m04:54:45.985499 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__creation
[0m04:54:45.985923 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__defense
[0m04:54:45.986498 [info ] [Thread-1 (]: 2 of 9 START sql view model main.stg_fbref__defense ............................ [RUN]
[0m04:54:45.987017 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__creation, now model.nextgeneu_players.stg_fbref__defense)
[0m04:54:45.987469 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__defense
[0m04:54:45.993852 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__defense"
[0m04:54:45.994503 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__defense
[0m04:54:45.997843 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__defense"
[0m04:54:45.998497 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m04:54:45.998873 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: BEGIN
[0m04:54:45.999245 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:45.999885 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.000304 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m04:54:46.000703 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */

  
  create view "players"."main"."stg_fbref__defense__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."defensive_actions_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."defensive_actions_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."defensive_actions_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(tackles_tkl, ',', '') AS INTEGER)
 as tackles_total,
    
    TRY_CAST(REPLACE(tackles_tklw, ',', '') AS INTEGER)
 as tackles_won,
    
    TRY_CAST(REPLACE(tackles_att_3rd, ',', '') AS INTEGER)
 as tackles_att_3rd,
    
    TRY_CAST(REPLACE(unnamed_21_level_0_int, ',', '') AS INTEGER)
 as interceptions,
    
    TRY_CAST(REPLACE(unnamed_23_level_0_clr, ',', '') AS INTEGER)
 as clearances,
    
    TRY_CAST(REPLACE(blocks_sh, ',', '') AS INTEGER)
 as shots_blocked

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m04:54:46.002271 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.005375 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m04:54:46.005764 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */
alter view "players"."main"."stg_fbref__defense__dbt_tmp" rename to "stg_fbref__defense"
[0m04:54:46.006449 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.007610 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: COMMIT
[0m04:54:46.007988 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m04:54:46.008359 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: COMMIT
[0m04:54:46.010897 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.013442 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m04:54:46.013831 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */

      drop view if exists "players"."main"."stg_fbref__defense__dbt_backup" cascade
    
[0m04:54:46.014491 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.016668 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: Close
[0m04:54:46.017351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314da1d7d90>]}
[0m04:54:46.018051 [info ] [Thread-1 (]: 2 of 9 OK created sql view model main.stg_fbref__defense ....................... [[32mOK[0m in 0.03s]
[0m04:54:46.018852 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__defense
[0m04:54:46.019331 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__misc
[0m04:54:46.019879 [info ] [Thread-1 (]: 3 of 9 START sql view model main.stg_fbref__misc ............................... [RUN]
[0m04:54:46.020536 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__defense, now model.nextgeneu_players.stg_fbref__misc)
[0m04:54:46.020963 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__misc
[0m04:54:46.027904 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__misc"
[0m04:54:46.028528 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__misc
[0m04:54:46.031821 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__misc"
[0m04:54:46.032426 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m04:54:46.032828 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: BEGIN
[0m04:54:46.033233 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:46.033980 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.034388 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m04:54:46.034804 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */

  
  create view "players"."main"."stg_fbref__misc__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."miscellaneous_stats_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."miscellaneous_stats_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."miscellaneous_stats_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(performance_crdy, ',', '') AS INTEGER)
 as yellow_cards,
    
    TRY_CAST(REPLACE(performance_crdr, ',', '') AS INTEGER)
 as red_cards,
    
    TRY_CAST(REPLACE(performance_fls, ',', '') AS INTEGER)
 as fouls_committed,
    
    TRY_CAST(REPLACE(performance_fld, ',', '') AS INTEGER)
 as fouls_drawn,
    
    TRY_CAST(REPLACE(performance_off, ',', '') AS INTEGER)
 as offsides,
    
    TRY_CAST(REPLACE(performance_recov, ',', '') AS INTEGER)
 as ball_recoveries,
    
    TRY_CAST(REPLACE(aerial_duels_won, ',', '') AS INTEGER)
 as aerials_won,
    
    TRY_CAST(REPLACE(aerial_duels_lost, ',', '') AS INTEGER)
 as aerials_lost

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m04:54:46.036404 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.039464 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m04:54:46.039865 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */
alter view "players"."main"."stg_fbref__misc__dbt_tmp" rename to "stg_fbref__misc"
[0m04:54:46.040568 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.041707 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: COMMIT
[0m04:54:46.042112 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m04:54:46.042486 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: COMMIT
[0m04:54:46.044916 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.047454 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m04:54:46.047824 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */

      drop view if exists "players"."main"."stg_fbref__misc__dbt_backup" cascade
    
[0m04:54:46.048467 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.049711 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: Close
[0m04:54:46.050299 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d6788ca0>]}
[0m04:54:46.050914 [info ] [Thread-1 (]: 3 of 9 OK created sql view model main.stg_fbref__misc .......................... [[32mOK[0m in 0.03s]
[0m04:54:46.051596 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__misc
[0m04:54:46.051997 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__passing
[0m04:54:46.052563 [info ] [Thread-1 (]: 4 of 9 START sql view model main.stg_fbref__passing ............................ [RUN]
[0m04:54:46.053075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__misc, now model.nextgeneu_players.stg_fbref__passing)
[0m04:54:46.053476 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__passing
[0m04:54:46.059940 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__passing"
[0m04:54:46.060545 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__passing
[0m04:54:46.064904 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__passing"
[0m04:54:46.065526 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m04:54:46.065877 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: BEGIN
[0m04:54:46.066232 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:46.066876 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.067252 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m04:54:46.067631 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */

  
  create view "players"."main"."stg_fbref__passing__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."passing_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."passing_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."passing_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(total_cmp, ',', '') AS INTEGER)
 as passes_completed,
    
    TRY_CAST(REPLACE(total_att, ',', '') AS INTEGER)
 as passes_attempted,
    
    TRY_CAST(REPLACE(total_prgdist, ',', '') AS INTEGER)
 as pass_progressive_distance,
    
    TRY_CAST(REPLACE(unnamed_27_level_0_kp, ',', '') AS INTEGER)
 as key_passes,
    
    TRY_CAST(REPLACE(unnamed_29_level_0_ppa, ',', '') AS INTEGER)
 as passes_into_penalty_area,
    
    TRY_CAST(REPLACE(unnamed_30_level_0_crspa, ',', '') AS INTEGER)
 as crosses_into_penalty_area

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m04:54:46.069870 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.073126 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m04:54:46.073497 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */
alter view "players"."main"."stg_fbref__passing__dbt_tmp" rename to "stg_fbref__passing"
[0m04:54:46.074190 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.075345 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: COMMIT
[0m04:54:46.075777 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m04:54:46.076217 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: COMMIT
[0m04:54:46.079040 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.081669 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m04:54:46.082077 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */

      drop view if exists "players"."main"."stg_fbref__passing__dbt_backup" cascade
    
[0m04:54:46.082715 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.083985 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: Close
[0m04:54:46.084615 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314db6182b0>]}
[0m04:54:46.085276 [info ] [Thread-1 (]: 4 of 9 OK created sql view model main.stg_fbref__passing ....................... [[32mOK[0m in 0.03s]
[0m04:54:46.086014 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__passing
[0m04:54:46.086459 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__playing_time
[0m04:54:46.087015 [info ] [Thread-1 (]: 5 of 9 START sql view model main.stg_fbref__playing_time ....................... [RUN]
[0m04:54:46.087547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__passing, now model.nextgeneu_players.stg_fbref__playing_time)
[0m04:54:46.087928 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__playing_time
[0m04:54:46.093653 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__playing_time"
[0m04:54:46.094239 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__playing_time
[0m04:54:46.097664 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__playing_time"
[0m04:54:46.098254 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m04:54:46.098640 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: BEGIN
[0m04:54:46.099005 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:46.099693 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.100100 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m04:54:46.100528 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */

  
  create view "players"."main"."stg_fbref__playing_time__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."playing_time_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."playing_time_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."playing_time_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_1_level_0_player as player_name,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(playing_time_mp, ',', '') AS INTEGER)
 as matches_played,
    
    TRY_CAST(REPLACE(starts_starts, ',', '') AS INTEGER)
 as starts,
    
    TRY_CAST(REPLACE(subs_subs, ',', '') AS INTEGER)
 as substitutions_on,
    
    TRY_CAST(REPLACE(subs_unsub, ',', '') AS INTEGER)
 as unused_sub,
    
    -- Team Success (Plus/Minus)
    TRY_CAST(team_success_onoff AS FLOAT) as plus_minus_net_per_90

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m04:54:46.102180 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.106349 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m04:54:46.106728 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */
alter view "players"."main"."stg_fbref__playing_time__dbt_tmp" rename to "stg_fbref__playing_time"
[0m04:54:46.107402 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.108523 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: COMMIT
[0m04:54:46.108884 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m04:54:46.109236 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: COMMIT
[0m04:54:46.112123 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m04:54:46.114601 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m04:54:46.115013 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */

      drop view if exists "players"."main"."stg_fbref__playing_time__dbt_backup" cascade
    
[0m04:54:46.115674 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.116908 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: Close
[0m04:54:46.117514 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314db6182b0>]}
[0m04:54:46.118161 [info ] [Thread-1 (]: 5 of 9 OK created sql view model main.stg_fbref__playing_time .................. [[32mOK[0m in 0.03s]
[0m04:54:46.118872 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__playing_time
[0m04:54:46.119349 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__possession
[0m04:54:46.119899 [info ] [Thread-1 (]: 6 of 9 START sql view model main.stg_fbref__possession ......................... [RUN]
[0m04:54:46.120511 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__playing_time, now model.nextgeneu_players.stg_fbref__possession)
[0m04:54:46.120863 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__possession
[0m04:54:46.128012 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__possession"
[0m04:54:46.128601 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__possession
[0m04:54:46.132720 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__possession"
[0m04:54:46.133327 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m04:54:46.133720 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: BEGIN
[0m04:54:46.134103 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:46.134831 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.135235 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m04:54:46.135719 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */

  
  create view "players"."main"."stg_fbref__possession__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."possession_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."possession_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."possession_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(touches_touches, ',', '') AS INTEGER)
 as touches,
    
    TRY_CAST(REPLACE(touches_att_pen, ',', '') AS INTEGER)
 as touches_att_pen,
    
    TRY_CAST(REPLACE(takeons_succ, ',', '') AS INTEGER)
 as takeons_won,
    
    TRY_CAST(REPLACE(takeons_att, ',', '') AS INTEGER)
 as takeons_attempted,
    
    TRY_CAST(REPLACE(carries_prgdist, ',', '') AS INTEGER)
 as carry_progressive_distance,
    
    TRY_CAST(REPLACE(carries_cpa, ',', '') AS INTEGER)
 as carries_into_penalty_area

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m04:54:46.137362 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.140831 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m04:54:46.141260 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */
alter view "players"."main"."stg_fbref__possession__dbt_tmp" rename to "stg_fbref__possession"
[0m04:54:46.141970 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.143187 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: COMMIT
[0m04:54:46.143574 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m04:54:46.143932 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: COMMIT
[0m04:54:46.146391 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.149201 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m04:54:46.149610 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */

      drop view if exists "players"."main"."stg_fbref__possession__dbt_backup" cascade
    
[0m04:54:46.150322 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.151656 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: Close
[0m04:54:46.152266 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d03cd2a0>]}
[0m04:54:46.152893 [info ] [Thread-1 (]: 6 of 9 OK created sql view model main.stg_fbref__possession .................... [[32mOK[0m in 0.03s]
[0m04:54:46.153605 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__possession
[0m04:54:46.154019 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__shooting
[0m04:54:46.154583 [info ] [Thread-1 (]: 7 of 9 START sql view model main.stg_fbref__shooting ........................... [RUN]
[0m04:54:46.155116 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__possession, now model.nextgeneu_players.stg_fbref__shooting)
[0m04:54:46.155499 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__shooting
[0m04:54:46.161887 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__shooting"
[0m04:54:46.162468 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__shooting
[0m04:54:46.165744 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__shooting"
[0m04:54:46.166320 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m04:54:46.166706 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: BEGIN
[0m04:54:46.167068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:46.167748 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.168223 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m04:54:46.168642 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */

  
  create view "players"."main"."stg_fbref__shooting__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."shooting_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."shooting_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."shooting_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(standard_sh, ',', '') AS INTEGER)
 as shots_total,
    
    TRY_CAST(REPLACE(standard_sot, ',', '') AS INTEGER)
 as shots_on_target,
    TRY_CAST(standard_dist AS FLOAT) as avg_shot_distance

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m04:54:46.170072 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.173031 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m04:54:46.173461 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */
alter view "players"."main"."stg_fbref__shooting__dbt_tmp" rename to "stg_fbref__shooting"
[0m04:54:46.174194 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.175349 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: COMMIT
[0m04:54:46.175742 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m04:54:46.176126 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: COMMIT
[0m04:54:46.178690 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.181951 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m04:54:46.182452 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */

      drop view if exists "players"."main"."stg_fbref__shooting__dbt_backup" cascade
    
[0m04:54:46.183062 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.184296 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: Close
[0m04:54:46.184853 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314db6182b0>]}
[0m04:54:46.185520 [info ] [Thread-1 (]: 7 of 9 OK created sql view model main.stg_fbref__shooting ...................... [[32mOK[0m in 0.03s]
[0m04:54:46.186237 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__shooting
[0m04:54:46.186628 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__standard
[0m04:54:46.187171 [info ] [Thread-1 (]: 8 of 9 START sql view model main.stg_fbref__standard ........................... [RUN]
[0m04:54:46.187700 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__shooting, now model.nextgeneu_players.stg_fbref__standard)
[0m04:54:46.188055 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__standard
[0m04:54:46.196292 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.196870 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__standard
[0m04:54:46.201294 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.201867 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.202239 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: BEGIN
[0m04:54:46.202561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:46.203276 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.203630 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.204053 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

  
  create view "players"."main"."stg_fbref__standard__dbt_tmp" as (
    -- 1. CONFIGURATION


WITH raw_union AS (
    
        SELECT 
            *, 
            '2023_2024' as source_season_id 
        FROM "players"."raw"."standard_stats_2023_2024"
         UNION ALL 
    
        SELECT 
            *, 
            '2024_2025' as source_season_id 
        FROM "players"."raw"."standard_stats_2024_2025"
         UNION ALL 
    
        SELECT 
            *, 
            '2025_2026' as source_season_id 
        FROM "players"."raw"."standard_stats_2025_2026"
        
    
),

cleaned AS (
    SELECT
        -- 1. IDENTITY (The Golden Key)
        
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
        
        -- 2. METADATA
        unnamed_1_level_0_player as player_name,
        unnamed_2_level_0_nation as nation,
        unnamed_4_level_0_squad  as squad,
        unnamed_3_level_0_pos    as primary_position,
        unnamed_5_level_0_comp   as competition,
        source_season_id         as season_id,
        
        -- 3. DEMOGRAPHICS
        
    TRY_CAST(SPLIT_PART(unnamed_6_level_0_age, '-', 1) AS INTEGER)
 as age,
        
    TRY_CAST(REPLACE(unnamed_7_level_0_born, ',', '') AS INTEGER)
 as birth_year,

        -- 4. PLAYING TIME
        
    TRY_CAST(REPLACE(playing_time_mp, ',', '') AS INTEGER)
 as matches_played,
        
    TRY_CAST(REPLACE(playing_time_starts, ',', '') AS INTEGER)
 as matches_started,
        
    TRY_CAST(REPLACE(playing_time_min, ',', '') AS INTEGER)
 as minutes_played,
        TRY_CAST(playing_time_90s AS FLOAT) as minutes_90s,

        -- 5. PERFORMANCE METRICS (Using the macro to handle commas/types)
        
    TRY_CAST(REPLACE(performance_gls, ',', '') AS INTEGER)
 as goals,
        
    TRY_CAST(REPLACE(performance_ast, ',', '') AS INTEGER)
 as assists,
        
    TRY_CAST(REPLACE(performance_ga, ',', '') AS INTEGER)
 as goals_assists,
        
    TRY_CAST(REPLACE(performance_pk, ',', '') AS INTEGER)
 as penalties_made,
        
    TRY_CAST(REPLACE(performance_pkatt, ',', '') AS INTEGER)
 as penalties_att,
        
        -- 6. EXPECTED METRICS
        TRY_CAST(expected_xg AS FLOAT) as xg,
        TRY_CAST(expected_npxg AS FLOAT) as npxg,
        TRY_CAST(expected_xag AS FLOAT) as xag,
        
        -- 7. PROGRESSION
        
    TRY_CAST(REPLACE(progression_prgc, ',', '') AS INTEGER)
 as progressive_carries,
        
    TRY_CAST(REPLACE(progression_prgp, ',', '') AS INTEGER)
 as progressive_passes,
        
    TRY_CAST(REPLACE(progression_prgr, ',', '') AS INTEGER)
 as progressive_receptions

    FROM raw_union
)

SELECT * FROM cleaned
WHERE player_name != 'Player' -- Filter header rows
  AND player_name IS NOT NULL
  );

[0m04:54:46.206997 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.268937 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.269704 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */
alter view "players"."main"."stg_fbref__standard" rename to "stg_fbref__standard__dbt_backup"
[0m04:54:46.271100 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.274607 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.275017 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */
alter view "players"."main"."stg_fbref__standard__dbt_tmp" rename to "stg_fbref__standard"
[0m04:54:46.275769 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.278989 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m04:54:46.279414 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.279790 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m04:54:46.282730 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m04:54:46.285732 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m04:54:46.286252 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

      drop view if exists "players"."main"."stg_fbref__standard__dbt_backup" cascade
    
[0m04:54:46.288270 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.289722 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: Close
[0m04:54:46.290462 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d0249cc0>]}
[0m04:54:46.291233 [info ] [Thread-1 (]: 8 of 9 OK created sql view model main.stg_fbref__standard ...................... [[32mOK[0m in 0.10s]
[0m04:54:46.291986 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__standard
[0m04:54:46.292948 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.int_player_season_stats
[0m04:54:46.293568 [info ] [Thread-1 (]: 9 of 9 START sql view model main.int_player_season_stats ....................... [RUN]
[0m04:54:46.294175 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__standard, now model.nextgeneu_players.int_player_season_stats)
[0m04:54:46.294726 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.int_player_season_stats
[0m04:54:46.301238 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.int_player_season_stats"
[0m04:54:46.302118 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.int_player_season_stats
[0m04:54:46.306396 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.int_player_season_stats"
[0m04:54:46.307142 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m04:54:46.307537 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: BEGIN
[0m04:54:46.307965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:54:46.308846 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:54:46.309264 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m04:54:46.309729 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */

  
  create view "players"."main"."int_player_season_stats__dbt_tmp" as (
    WITH standard AS (SELECT * FROM "players"."main"."stg_fbref__standard"),
     shooting AS (SELECT * FROM "players"."main"."stg_fbref__shooting"),
     passing  AS (SELECT * FROM "players"."main"."stg_fbref__passing"),
     defense  AS (SELECT * FROM "players"."main"."stg_fbref__defense"),
     poss     AS (SELECT * FROM "players"."main"."stg_fbref__possession"),
     misc     AS (SELECT * FROM "players"."main"."stg_fbref__misc")

SELECT
    -- Anchors
    s.player_id,
    s.player_name,
    s.season_id,
    s.squad,
    s.nation,
    s.primary_position,
    s.age,
    s.birth_year,
    s.minutes_90s,

    -- Attacking Metrics
    s.goals,
    s.assists,
    s.npxg,
    s.xag,
    coalesce(sh.shots_total, 0) as shots_total,
    coalesce(sh.shots_on_target, 0) as shots_on_target,

    -- Possession & Creation
    coalesce(p.key_passes, 0) as key_passes,
    coalesce(p.pass_progressive_distance, 0) as pass_progressive_distance,
    coalesce(poss.carry_progressive_distance, 0) as carry_progressive_distance,
    coalesce(poss.takeons_won, 0) as takeons_won,

    -- Defensive Workrate
    coalesce(d.tackles_won, 0) as tackles_won,
    coalesce(d.interceptions, 0) as interceptions,
    coalesce(d.tackles_att_3rd, 0) as tackles_att_3rd,
    coalesce(m.ball_recoveries, 0) as recoveries,
    coalesce(m.aerials_won, 0) as aerials_won

FROM standard s
LEFT JOIN shooting sh USING (player_id, squad, season_id)
LEFT JOIN passing p   USING (player_id, squad, season_id)
LEFT JOIN defense d   USING (player_id, squad, season_id)
LEFT JOIN poss        USING (player_id, squad, season_id)
LEFT JOIN misc m      USING (player_id, squad, season_id)

-- Filter out rows where the join keys might have drifted or empty names
WHERE s.player_id IS NOT NULL
  );

[0m04:54:46.316977 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m04:54:46.321989 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m04:54:46.322433 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */
alter view "players"."main"."int_player_season_stats__dbt_tmp" rename to "int_player_season_stats"
[0m04:54:46.323227 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.324447 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: COMMIT
[0m04:54:46.324857 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m04:54:46.325246 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: COMMIT
[0m04:54:46.327946 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m04:54:46.331746 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m04:54:46.332253 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */

      drop view if exists "players"."main"."int_player_season_stats__dbt_backup" cascade
    
[0m04:54:46.333031 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:54:46.334449 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: Close
[0m04:54:46.335115 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b00efeb-c9ed-4742-ac6d-b0c72e21feb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d416ed10>]}
[0m04:54:46.335791 [info ] [Thread-1 (]: 9 of 9 OK created sql view model main.int_player_season_stats .................. [[32mOK[0m in 0.04s]
[0m04:54:46.336513 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.int_player_season_stats
[0m04:54:46.337643 [debug] [MainThread]: Using duckdb connection "master"
[0m04:54:46.337968 [debug] [MainThread]: On master: BEGIN
[0m04:54:46.338289 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m04:54:46.338890 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m04:54:46.339249 [debug] [MainThread]: On master: COMMIT
[0m04:54:46.339565 [debug] [MainThread]: Using duckdb connection "master"
[0m04:54:46.339865 [debug] [MainThread]: On master: COMMIT
[0m04:54:46.340418 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m04:54:46.340790 [debug] [MainThread]: On master: Close
[0m04:54:46.341293 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:54:46.341633 [debug] [MainThread]: Connection 'model.nextgeneu_players.int_player_season_stats' was properly closed.
[0m04:54:46.342160 [info ] [MainThread]: 
[0m04:54:46.342569 [info ] [MainThread]: Finished running 9 view models in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m04:54:46.344772 [debug] [MainThread]: Command end result
[0m04:54:46.390851 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m04:54:46.393388 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m04:54:46.400717 [debug] [MainThread]: Wrote artifact RunExecutionResult to /app/transformation/target/run_results.json
[0m04:54:46.401070 [info ] [MainThread]: 
[0m04:54:46.401596 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:54:46.402019 [info ] [MainThread]: 
[0m04:54:46.402460 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=9
[0m04:54:46.403551 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.7980171, "process_in_blocks": "240", "process_kernel_time": 0.226198, "process_mem_max_rss": "175708", "process_out_blocks": "4648", "process_user_time": 3.317909}
[0m04:54:46.404133 [debug] [MainThread]: Command `dbt run` succeeded at 04:54:46.403986 after 1.80 seconds
[0m04:54:46.404587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314db324700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314da3b3f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7314d3997340>]}
[0m04:54:46.405128 [debug] [MainThread]: Flushing usage events
[0m04:54:46.914530 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:59:12.061923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf3844730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf271c7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf271c430>]}


============================== 04:59:12.067136 | 304fb971-a6bf-47d9-b65f-c9593650e10f ==============================
[0m04:59:12.067136 [info ] [MainThread]: Running with dbt=1.10.15
[0m04:59:12.067843 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'debug': 'False', 'log_path': '/app/transformation/logs', 'use_experimental_parser': 'False', 'introspect': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'fail_fast': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'target_path': 'None', 'partial_parse': 'True', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'invocation_command': 'dbt build --select marts', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/app/transformation', 'static_parser': 'True', 'no_print': 'None'}
[0m04:59:12.322345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '304fb971-a6bf-47d9-b65f-c9593650e10f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf262fb80>]}
[0m04:59:12.393168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '304fb971-a6bf-47d9-b65f-c9593650e10f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf27ecd90>]}
[0m04:59:12.395116 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m04:59:12.490167 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m04:59:12.618316 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m04:59:12.619040 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/marts/scouting/mart_scouting_analysis.sql
[0m04:59:12.619461 [debug] [MainThread]: Partial parsing: added file: nextgeneu_players://models/marts/dim_players.sql
[0m04:59:12.974904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '304fb971-a6bf-47d9-b65f-c9593650e10f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adec190130>]}
[0m04:59:13.082780 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m04:59:13.084790 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m04:59:13.112972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '304fb971-a6bf-47d9-b65f-c9593650e10f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adec1d2110>]}
[0m04:59:13.113569 [info ] [MainThread]: Found 11 models, 33 sources, 586 macros
[0m04:59:13.115462 [info ] [MainThread]: 
[0m04:59:13.115897 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:59:13.116327 [info ] [MainThread]: 
[0m04:59:13.116999 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m04:59:13.123632 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_players'
[0m04:59:13.164262 [debug] [ThreadPool]: Using duckdb connection "list_players"
[0m04:59:13.164902 [debug] [ThreadPool]: On list_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"players"'
    
  
  
[0m04:59:13.165349 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:59:13.198052 [debug] [ThreadPool]: SQL status: OK in 0.033 seconds
[0m04:59:13.199690 [debug] [ThreadPool]: On list_players: Close
[0m04:59:13.200540 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_players, now create_players_main)
[0m04:59:13.201048 [debug] [ThreadPool]: Creating schema "database: "players"
schema: "main"
"
[0m04:59:13.208853 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:59:13.209257 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='players'
        and type='sqlite'
    
  
[0m04:59:13.209564 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:59:13.210940 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m04:59:13.212201 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:59:13.212520 [debug] [ThreadPool]: On create_players_main: BEGIN
[0m04:59:13.213050 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:59:13.213397 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:59:13.213703 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
    
        create schema if not exists "players"."main"
    
[0m04:59:13.214333 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:59:13.215126 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m04:59:13.215451 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m04:59:13.215745 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m04:59:13.216265 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m04:59:13.216592 [debug] [ThreadPool]: On create_players_main: Close
[0m04:59:13.218360 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_players_main, now list_players_main)
[0m04:59:13.224316 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m04:59:13.224658 [debug] [ThreadPool]: On list_players_main: BEGIN
[0m04:59:13.224951 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:59:13.225619 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m04:59:13.225936 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m04:59:13.226281 [debug] [ThreadPool]: On list_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players_main"} */
select
      'players' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'players'
  
[0m04:59:13.238379 [debug] [ThreadPool]: SQL status: OK in 0.012 seconds
[0m04:59:13.239864 [debug] [ThreadPool]: On list_players_main: ROLLBACK
[0m04:59:13.240442 [debug] [ThreadPool]: Failed to rollback 'list_players_main'
[0m04:59:13.240755 [debug] [ThreadPool]: On list_players_main: Close
[0m04:59:13.242846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '304fb971-a6bf-47d9-b65f-c9593650e10f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adec65dff0>]}
[0m04:59:13.243351 [debug] [MainThread]: Using duckdb connection "master"
[0m04:59:13.243681 [debug] [MainThread]: On master: BEGIN
[0m04:59:13.243985 [debug] [MainThread]: Opening a new connection, currently in state init
[0m04:59:13.244734 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m04:59:13.245069 [debug] [MainThread]: On master: COMMIT
[0m04:59:13.245433 [debug] [MainThread]: Using duckdb connection "master"
[0m04:59:13.245748 [debug] [MainThread]: On master: COMMIT
[0m04:59:13.246283 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m04:59:13.246622 [debug] [MainThread]: On master: Close
[0m04:59:13.250646 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.dim_players
[0m04:59:13.251210 [info ] [Thread-1 (]: 1 of 2 START sql table model main.dim_players .................................. [RUN]
[0m04:59:13.251766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_players_main, now model.nextgeneu_players.dim_players)
[0m04:59:13.252213 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.dim_players
[0m04:59:13.260806 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.dim_players"
[0m04:59:13.261493 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.dim_players
[0m04:59:13.294455 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.dim_players"
[0m04:59:13.295344 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m04:59:13.295746 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: BEGIN
[0m04:59:13.296142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:59:13.297255 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:59:13.297674 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m04:59:13.298077 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

  
    
    

    create  table
      "players"."main"."dim_players__dbt_tmp"
  
    as (
      WITH unique_players AS (
    SELECT 
        player_id,
        -- Get the most recently used name (in case it changed)
        arg_max(player_name, season_id) as player_name,
        -- Get the most recent nation/position
        arg_max(nation, season_id) as nation,
        arg_max(primary_position, season_id) as primary_position,
        max(birth_year) as birth_year
    FROM "players"."main"."int_player_season_stats"
    GROUP BY player_id
)

SELECT * FROM unique_players
    );
  
  
[0m04:59:13.333125 [debug] [Thread-1 (]: SQL status: OK in 0.034 seconds
[0m04:59:13.340212 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m04:59:13.340650 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */
alter table "players"."main"."dim_players__dbt_tmp" rename to "dim_players"
[0m04:59:13.341496 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:59:13.356040 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: COMMIT
[0m04:59:13.356544 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m04:59:13.356941 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: COMMIT
[0m04:59:13.379833 [debug] [Thread-1 (]: SQL status: OK in 0.022 seconds
[0m04:59:13.386420 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m04:59:13.386861 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

      drop table if exists "players"."main"."dim_players__dbt_backup" cascade
    
[0m04:59:13.387677 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:59:13.391262 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: Close
[0m04:59:13.392984 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '304fb971-a6bf-47d9-b65f-c9593650e10f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf5550250>]}
[0m04:59:13.393672 [info ] [Thread-1 (]: 1 of 2 OK created sql table model main.dim_players ............................. [[32mOK[0m in 0.14s]
[0m04:59:13.394360 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.dim_players
[0m04:59:13.394788 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.mart_scouting_analysis
[0m04:59:13.395361 [info ] [Thread-1 (]: 2 of 2 START sql table model main.mart_scouting_analysis ....................... [RUN]
[0m04:59:13.395882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.dim_players, now model.nextgeneu_players.mart_scouting_analysis)
[0m04:59:13.396284 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.mart_scouting_analysis
[0m04:59:13.400995 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.mart_scouting_analysis"
[0m04:59:13.401831 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.mart_scouting_analysis
[0m04:59:13.407359 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.mart_scouting_analysis"
[0m04:59:13.408247 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m04:59:13.408667 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: BEGIN
[0m04:59:13.409057 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:59:13.409969 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:59:13.410431 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m04:59:13.410884 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

  
    
    

    create  table
      "players"."main"."mart_scouting_analysis__dbt_tmp"
  
    as (
      WITH base_stats AS (
    SELECT * FROM "players"."main"."int_player_season_stats"
    WHERE minutes_90s >= 5.0 -- Filter: Remove noise (players with < 5 games)
),

per_90_calculations AS (
    SELECT 
        *,
        -- 1. ATTACK SCORES
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE goals + assists / minutes_90s
    END
 as goal_contribution_per_90,
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE npxg + xag / minutes_90s
    END
 as expected_contribution_per_90,
        
        -- 2. PROGRESSION SCORES (The "Engine" Metric)
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE pass_progressive_distance + carry_progressive_distance / minutes_90s
    END
 as progression_total_dist_per_90,
        
        -- 3. DEFENSIVE SCORES (The "Workrate" Metric)
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE tackles_won + interceptions + recoveries / minutes_90s
    END
 as defensive_actions_per_90,
        
        -- 4. FLAGS
        CASE WHEN (2026 - birth_year) <= 23 THEN TRUE ELSE FALSE END as is_u23_prospect
    FROM base_stats
)

SELECT 
    *,
    -- Percentile Ranks (0.0 to 1.0)
    -- Compare players only against peers in the SAME position and SAME season
    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY expected_contribution_per_90 ASC
    ) as percentile_attacking,

    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY progression_total_dist_per_90 ASC
    ) as percentile_progression,

    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY defensive_actions_per_90 ASC
    ) as percentile_defense

FROM per_90_calculations
    );
  
  
[0m04:59:13.457762 [debug] [Thread-1 (]: SQL status: OK in 0.046 seconds
[0m04:59:13.461707 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m04:59:13.462171 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */
alter table "players"."main"."mart_scouting_analysis__dbt_tmp" rename to "mart_scouting_analysis"
[0m04:59:13.463117 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m04:59:13.464455 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: COMMIT
[0m04:59:13.464855 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m04:59:13.465244 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: COMMIT
[0m04:59:13.483271 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m04:59:13.486605 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m04:59:13.487041 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

      drop table if exists "players"."main"."mart_scouting_analysis__dbt_backup" cascade
    
[0m04:59:13.487958 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m04:59:13.489439 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: Close
[0m04:59:13.490177 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '304fb971-a6bf-47d9-b65f-c9593650e10f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adec6f0340>]}
[0m04:59:13.490892 [info ] [Thread-1 (]: 2 of 2 OK created sql table model main.mart_scouting_analysis .................. [[32mOK[0m in 0.09s]
[0m04:59:13.491582 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.mart_scouting_analysis
[0m04:59:13.493250 [debug] [MainThread]: Using duckdb connection "master"
[0m04:59:13.493595 [debug] [MainThread]: On master: BEGIN
[0m04:59:13.493908 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m04:59:13.494585 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m04:59:13.494922 [debug] [MainThread]: On master: COMMIT
[0m04:59:13.495279 [debug] [MainThread]: Using duckdb connection "master"
[0m04:59:13.495589 [debug] [MainThread]: On master: COMMIT
[0m04:59:13.496143 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m04:59:13.496483 [debug] [MainThread]: On master: Close
[0m04:59:13.496964 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:59:13.497314 [debug] [MainThread]: Connection 'model.nextgeneu_players.mart_scouting_analysis' was properly closed.
[0m04:59:13.497688 [info ] [MainThread]: 
[0m04:59:13.498175 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 0.38 seconds (0.38s).
[0m04:59:13.499338 [debug] [MainThread]: Command end result
[0m04:59:13.538170 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m04:59:13.540246 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m04:59:13.547225 [debug] [MainThread]: Wrote artifact RunExecutionResult to /app/transformation/target/run_results.json
[0m04:59:13.547548 [info ] [MainThread]: 
[0m04:59:13.548026 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:59:13.548450 [info ] [MainThread]: 
[0m04:59:13.548911 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m04:59:13.550029 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.5498374, "process_in_blocks": "4112", "process_kernel_time": 0.25489, "process_mem_max_rss": "357428", "process_out_blocks": "6752", "process_user_time": 3.205194}
[0m04:59:13.550579 [debug] [MainThread]: Command `dbt build` succeeded at 04:59:13.550469 after 1.55 seconds
[0m04:59:13.550963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf3844730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ade67dbc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71adf262dea0>]}
[0m04:59:13.551396 [debug] [MainThread]: Flushing usage events
[0m04:59:13.967128 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:05:23.763378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546dabf8670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546daa9f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d9abeb30>]}


============================== 05:05:23.768532 | 7f790f71-a1c4-4d61-b51d-08843c30139b ==============================
[0m05:05:23.768532 [info ] [MainThread]: Running with dbt=1.10.15
[0m05:05:23.769124 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'warn_error': 'None', 'invocation_command': 'dbt build', 'empty': 'False', 'log_format': 'default', 'debug': 'False', 'target_path': 'None', 'log_path': '/app/transformation/logs', 'cache_selected_only': 'False', 'version_check': 'True', 'write_json': 'True', 'no_print': 'None', 'quiet': 'False', 'profiles_dir': '/app/transformation', 'static_parser': 'True', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'use_colors': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False'}
[0m05:05:24.024638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546daa9e650>]}
[0m05:05:24.114737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546da36a980>]}
[0m05:05:24.116743 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m05:05:24.217278 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m05:05:24.357065 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:05:24.357799 [debug] [MainThread]: Partial parsing: updated file: nextgeneu_players://models/intermediate/int_player_season_stats.sql
[0m05:05:24.700811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d2948130>]}
[0m05:05:24.800681 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m05:05:24.802535 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m05:05:24.831832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d29a46d0>]}
[0m05:05:24.832407 [info ] [MainThread]: Found 11 models, 33 sources, 586 macros
[0m05:05:24.835527 [info ] [MainThread]: 
[0m05:05:24.835974 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:05:24.836432 [info ] [MainThread]: 
[0m05:05:24.837129 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m05:05:24.844284 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_players'
[0m05:05:24.884075 [debug] [ThreadPool]: Using duckdb connection "list_players"
[0m05:05:24.884576 [debug] [ThreadPool]: On list_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"players"'
    
  
  
[0m05:05:24.884906 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:05:24.914735 [debug] [ThreadPool]: SQL status: OK in 0.030 seconds
[0m05:05:24.916333 [debug] [ThreadPool]: On list_players: Close
[0m05:05:24.917076 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_players, now create_players_main)
[0m05:05:24.917625 [debug] [ThreadPool]: Creating schema "database: "players"
schema: "main"
"
[0m05:05:24.926694 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:05:24.927106 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='players'
        and type='sqlite'
    
  
[0m05:05:24.927447 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:05:24.928541 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m05:05:24.929782 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:05:24.930135 [debug] [ThreadPool]: On create_players_main: BEGIN
[0m05:05:24.930663 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m05:05:24.930994 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:05:24.931351 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
    
        create schema if not exists "players"."main"
    
[0m05:05:24.931917 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m05:05:24.932734 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m05:05:24.933065 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:05:24.933406 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m05:05:24.933938 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m05:05:24.934291 [debug] [ThreadPool]: On create_players_main: Close
[0m05:05:24.936065 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_players_main, now list_players_main)
[0m05:05:24.941957 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m05:05:24.942323 [debug] [ThreadPool]: On list_players_main: BEGIN
[0m05:05:24.942623 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:05:24.943250 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m05:05:24.943578 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m05:05:24.943903 [debug] [ThreadPool]: On list_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players_main"} */
select
      'players' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'players'
  
[0m05:05:24.957418 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m05:05:24.959029 [debug] [ThreadPool]: On list_players_main: ROLLBACK
[0m05:05:24.959607 [debug] [ThreadPool]: Failed to rollback 'list_players_main'
[0m05:05:24.959920 [debug] [ThreadPool]: On list_players_main: Close
[0m05:05:24.962287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d32f9f90>]}
[0m05:05:24.962760 [debug] [MainThread]: Using duckdb connection "master"
[0m05:05:24.963078 [debug] [MainThread]: On master: BEGIN
[0m05:05:24.963415 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:05:24.964046 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m05:05:24.964408 [debug] [MainThread]: On master: COMMIT
[0m05:05:24.964725 [debug] [MainThread]: Using duckdb connection "master"
[0m05:05:24.965026 [debug] [MainThread]: On master: COMMIT
[0m05:05:24.965634 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m05:05:24.966043 [debug] [MainThread]: On master: Close
[0m05:05:24.969723 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__creation
[0m05:05:24.970312 [info ] [Thread-1 (]: 1 of 11 START sql view model main.stg_fbref__creation .......................... [RUN]
[0m05:05:24.970858 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_players_main, now model.nextgeneu_players.stg_fbref__creation)
[0m05:05:24.971309 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__creation
[0m05:05:24.984838 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:24.985561 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__creation
[0m05:05:25.016644 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:25.017762 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:25.018365 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: BEGIN
[0m05:05:25.018842 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.020056 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.020612 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:25.021218 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */

  
  create view "players"."main"."stg_fbref__creation__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(sca_sca, ',', '') AS INTEGER)
 as shot_creating_actions,
    
    TRY_CAST(REPLACE(gca_gca, ',', '') AS INTEGER)
 as goal_creating_actions

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:05:25.023536 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.031707 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:25.032203 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */
alter view "players"."main"."stg_fbref__creation" rename to "stg_fbref__creation__dbt_backup"
[0m05:05:25.033188 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.036536 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:25.036913 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */
alter view "players"."main"."stg_fbref__creation__dbt_tmp" rename to "stg_fbref__creation"
[0m05:05:25.037622 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.051060 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: COMMIT
[0m05:05:25.051610 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:25.051978 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: COMMIT
[0m05:05:25.076266 [debug] [Thread-1 (]: SQL status: OK in 0.024 seconds
[0m05:05:25.084441 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:05:25.084935 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */

      drop view if exists "players"."main"."stg_fbref__creation__dbt_backup" cascade
    
[0m05:05:25.087174 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.089873 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: Close
[0m05:05:25.091646 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d1c50430>]}
[0m05:05:25.092326 [info ] [Thread-1 (]: 1 of 11 OK created sql view model main.stg_fbref__creation ..................... [[32mOK[0m in 0.12s]
[0m05:05:25.093014 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__creation
[0m05:05:25.093467 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__defense
[0m05:05:25.094077 [info ] [Thread-1 (]: 2 of 11 START sql view model main.stg_fbref__defense ........................... [RUN]
[0m05:05:25.094699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__creation, now model.nextgeneu_players.stg_fbref__defense)
[0m05:05:25.095149 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__defense
[0m05:05:25.101593 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.102230 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__defense
[0m05:05:25.105974 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.106625 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.107004 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: BEGIN
[0m05:05:25.107381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.108262 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.108652 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.109052 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */

  
  create view "players"."main"."stg_fbref__defense__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."defensive_actions_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."defensive_actions_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."defensive_actions_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(tackles_tkl, ',', '') AS INTEGER)
 as tackles_total,
    
    TRY_CAST(REPLACE(tackles_tklw, ',', '') AS INTEGER)
 as tackles_won,
    
    TRY_CAST(REPLACE(tackles_att_3rd, ',', '') AS INTEGER)
 as tackles_att_3rd,
    
    TRY_CAST(REPLACE(unnamed_21_level_0_int, ',', '') AS INTEGER)
 as interceptions,
    
    TRY_CAST(REPLACE(unnamed_23_level_0_clr, ',', '') AS INTEGER)
 as clearances,
    
    TRY_CAST(REPLACE(blocks_sh, ',', '') AS INTEGER)
 as shots_blocked

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:05:25.110660 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.114459 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.114929 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */
alter view "players"."main"."stg_fbref__defense" rename to "stg_fbref__defense__dbt_backup"
[0m05:05:25.115678 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.118782 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.119216 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */
alter view "players"."main"."stg_fbref__defense__dbt_tmp" rename to "stg_fbref__defense"
[0m05:05:25.119907 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.121186 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: COMMIT
[0m05:05:25.121580 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.121941 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: COMMIT
[0m05:05:25.124531 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.127318 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:05:25.127714 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */

      drop view if exists "players"."main"."stg_fbref__defense__dbt_backup" cascade
    
[0m05:05:25.129350 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.130673 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: Close
[0m05:05:25.131305 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546dacec580>]}
[0m05:05:25.131948 [info ] [Thread-1 (]: 2 of 11 OK created sql view model main.stg_fbref__defense ...................... [[32mOK[0m in 0.04s]
[0m05:05:25.132651 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__defense
[0m05:05:25.133061 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__misc
[0m05:05:25.133618 [info ] [Thread-1 (]: 3 of 11 START sql view model main.stg_fbref__misc .............................. [RUN]
[0m05:05:25.134155 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__defense, now model.nextgeneu_players.stg_fbref__misc)
[0m05:05:25.134547 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__misc
[0m05:05:25.142785 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.143514 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__misc
[0m05:05:25.147167 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.147776 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.148171 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: BEGIN
[0m05:05:25.148535 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.149324 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.149702 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.150120 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */

  
  create view "players"."main"."stg_fbref__misc__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."miscellaneous_stats_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."miscellaneous_stats_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."miscellaneous_stats_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(performance_crdy, ',', '') AS INTEGER)
 as yellow_cards,
    
    TRY_CAST(REPLACE(performance_crdr, ',', '') AS INTEGER)
 as red_cards,
    
    TRY_CAST(REPLACE(performance_fls, ',', '') AS INTEGER)
 as fouls_committed,
    
    TRY_CAST(REPLACE(performance_fld, ',', '') AS INTEGER)
 as fouls_drawn,
    
    TRY_CAST(REPLACE(performance_off, ',', '') AS INTEGER)
 as offsides,
    
    TRY_CAST(REPLACE(performance_recov, ',', '') AS INTEGER)
 as ball_recoveries,
    
    TRY_CAST(REPLACE(aerial_duels_won, ',', '') AS INTEGER)
 as aerials_won,
    
    TRY_CAST(REPLACE(aerial_duels_lost, ',', '') AS INTEGER)
 as aerials_lost

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:05:25.151768 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.155042 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.155450 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */
alter view "players"."main"."stg_fbref__misc" rename to "stg_fbref__misc__dbt_backup"
[0m05:05:25.156144 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.159076 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.159479 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */
alter view "players"."main"."stg_fbref__misc__dbt_tmp" rename to "stg_fbref__misc"
[0m05:05:25.160145 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.161353 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: COMMIT
[0m05:05:25.161749 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.162112 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: COMMIT
[0m05:05:25.164599 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.167211 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:05:25.167589 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */

      drop view if exists "players"."main"."stg_fbref__misc__dbt_backup" cascade
    
[0m05:05:25.169071 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.170322 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: Close
[0m05:05:25.170937 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546dacec580>]}
[0m05:05:25.171576 [info ] [Thread-1 (]: 3 of 11 OK created sql view model main.stg_fbref__misc ......................... [[32mOK[0m in 0.04s]
[0m05:05:25.172305 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__misc
[0m05:05:25.172727 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__passing
[0m05:05:25.173284 [info ] [Thread-1 (]: 4 of 11 START sql view model main.stg_fbref__passing ........................... [RUN]
[0m05:05:25.173828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__misc, now model.nextgeneu_players.stg_fbref__passing)
[0m05:05:25.174200 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__passing
[0m05:05:25.182436 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.182993 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__passing
[0m05:05:25.186350 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.186904 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.187275 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: BEGIN
[0m05:05:25.187595 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.188284 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.188669 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.189055 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */

  
  create view "players"."main"."stg_fbref__passing__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."passing_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."passing_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."passing_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(total_cmp, ',', '') AS INTEGER)
 as passes_completed,
    
    TRY_CAST(REPLACE(total_att, ',', '') AS INTEGER)
 as passes_attempted,
    
    TRY_CAST(REPLACE(total_prgdist, ',', '') AS INTEGER)
 as pass_progressive_distance,
    
    TRY_CAST(REPLACE(unnamed_27_level_0_kp, ',', '') AS INTEGER)
 as key_passes,
    
    TRY_CAST(REPLACE(unnamed_29_level_0_ppa, ',', '') AS INTEGER)
 as passes_into_penalty_area,
    
    TRY_CAST(REPLACE(unnamed_30_level_0_crspa, ',', '') AS INTEGER)
 as crosses_into_penalty_area

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:05:25.190704 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.193777 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.194166 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */
alter view "players"."main"."stg_fbref__passing" rename to "stg_fbref__passing__dbt_backup"
[0m05:05:25.194819 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.197723 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.198103 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */
alter view "players"."main"."stg_fbref__passing__dbt_tmp" rename to "stg_fbref__passing"
[0m05:05:25.198736 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.199980 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: COMMIT
[0m05:05:25.200357 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.200682 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: COMMIT
[0m05:05:25.203230 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.205839 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:05:25.206240 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */

      drop view if exists "players"."main"."stg_fbref__passing__dbt_backup" cascade
    
[0m05:05:25.208439 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.209690 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: Close
[0m05:05:25.210300 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546dacec580>]}
[0m05:05:25.210915 [info ] [Thread-1 (]: 4 of 11 OK created sql view model main.stg_fbref__passing ...................... [[32mOK[0m in 0.04s]
[0m05:05:25.211653 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__passing
[0m05:05:25.212071 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__playing_time
[0m05:05:25.212664 [info ] [Thread-1 (]: 5 of 11 START sql view model main.stg_fbref__playing_time ...................... [RUN]
[0m05:05:25.213217 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__passing, now model.nextgeneu_players.stg_fbref__playing_time)
[0m05:05:25.213628 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__playing_time
[0m05:05:25.220162 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.220768 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__playing_time
[0m05:05:25.281643 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.282471 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.282868 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: BEGIN
[0m05:05:25.283263 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.284150 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.284538 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.284946 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */

  
  create view "players"."main"."stg_fbref__playing_time__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."playing_time_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."playing_time_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."playing_time_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_1_level_0_player as player_name,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(playing_time_mp, ',', '') AS INTEGER)
 as matches_played,
    
    TRY_CAST(REPLACE(starts_starts, ',', '') AS INTEGER)
 as starts,
    
    TRY_CAST(REPLACE(subs_subs, ',', '') AS INTEGER)
 as substitutions_on,
    
    TRY_CAST(REPLACE(subs_unsub, ',', '') AS INTEGER)
 as unused_sub,
    
    -- Team Success (Plus/Minus)
    TRY_CAST(team_success_onoff AS FLOAT) as plus_minus_net_per_90

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:05:25.286726 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.290041 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.290464 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */
alter view "players"."main"."stg_fbref__playing_time" rename to "stg_fbref__playing_time__dbt_backup"
[0m05:05:25.291164 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.294178 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.294577 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */
alter view "players"."main"."stg_fbref__playing_time__dbt_tmp" rename to "stg_fbref__playing_time"
[0m05:05:25.295255 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.296517 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: COMMIT
[0m05:05:25.296911 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.297295 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: COMMIT
[0m05:05:25.299703 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.302328 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:05:25.302733 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */

      drop view if exists "players"."main"."stg_fbref__playing_time__dbt_backup" cascade
    
[0m05:05:25.304316 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.305578 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: Close
[0m05:05:25.306246 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d04ec9a0>]}
[0m05:05:25.306931 [info ] [Thread-1 (]: 5 of 11 OK created sql view model main.stg_fbref__playing_time ................. [[32mOK[0m in 0.09s]
[0m05:05:25.307649 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__playing_time
[0m05:05:25.308076 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__possession
[0m05:05:25.308639 [info ] [Thread-1 (]: 6 of 11 START sql view model main.stg_fbref__possession ........................ [RUN]
[0m05:05:25.309161 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__playing_time, now model.nextgeneu_players.stg_fbref__possession)
[0m05:05:25.309533 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__possession
[0m05:05:25.315470 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.316193 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__possession
[0m05:05:25.321305 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.321902 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.322300 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: BEGIN
[0m05:05:25.322668 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.323346 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.323752 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.324185 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */

  
  create view "players"."main"."stg_fbref__possession__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."possession_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."possession_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."possession_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(touches_touches, ',', '') AS INTEGER)
 as touches,
    
    TRY_CAST(REPLACE(touches_att_pen, ',', '') AS INTEGER)
 as touches_att_pen,
    
    TRY_CAST(REPLACE(takeons_succ, ',', '') AS INTEGER)
 as takeons_won,
    
    TRY_CAST(REPLACE(takeons_att, ',', '') AS INTEGER)
 as takeons_attempted,
    
    TRY_CAST(REPLACE(carries_prgdist, ',', '') AS INTEGER)
 as carry_progressive_distance,
    
    TRY_CAST(REPLACE(carries_cpa, ',', '') AS INTEGER)
 as carries_into_penalty_area

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:05:25.325762 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.328996 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.329429 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */
alter view "players"."main"."stg_fbref__possession" rename to "stg_fbref__possession__dbt_backup"
[0m05:05:25.330210 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.333271 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.333675 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */
alter view "players"."main"."stg_fbref__possession__dbt_tmp" rename to "stg_fbref__possession"
[0m05:05:25.334350 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.335620 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: COMMIT
[0m05:05:25.336009 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.336397 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: COMMIT
[0m05:05:25.338971 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.341574 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:05:25.341979 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */

      drop view if exists "players"."main"."stg_fbref__possession__dbt_backup" cascade
    
[0m05:05:25.344238 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.345496 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: Close
[0m05:05:25.346098 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d32fbb80>]}
[0m05:05:25.346809 [info ] [Thread-1 (]: 6 of 11 OK created sql view model main.stg_fbref__possession ................... [[32mOK[0m in 0.04s]
[0m05:05:25.347549 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__possession
[0m05:05:25.348031 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__shooting
[0m05:05:25.348841 [info ] [Thread-1 (]: 7 of 11 START sql view model main.stg_fbref__shooting .......................... [RUN]
[0m05:05:25.349566 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__possession, now model.nextgeneu_players.stg_fbref__shooting)
[0m05:05:25.350104 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__shooting
[0m05:05:25.355715 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.356306 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__shooting
[0m05:05:25.359807 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.360392 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.360759 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: BEGIN
[0m05:05:25.361111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.361790 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.362202 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.362620 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */

  
  create view "players"."main"."stg_fbref__shooting__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."shooting_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."shooting_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."shooting_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(standard_sh, ',', '') AS INTEGER)
 as shots_total,
    
    TRY_CAST(REPLACE(standard_sot, ',', '') AS INTEGER)
 as shots_on_target,
    TRY_CAST(standard_dist AS FLOAT) as avg_shot_distance

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:05:25.364053 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.368281 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.368732 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */
alter view "players"."main"."stg_fbref__shooting" rename to "stg_fbref__shooting__dbt_backup"
[0m05:05:25.369406 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.372480 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.372855 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */
alter view "players"."main"."stg_fbref__shooting__dbt_tmp" rename to "stg_fbref__shooting"
[0m05:05:25.373513 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.374748 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: COMMIT
[0m05:05:25.375154 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.375503 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: COMMIT
[0m05:05:25.377415 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.380006 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:05:25.380438 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */

      drop view if exists "players"."main"."stg_fbref__shooting__dbt_backup" cascade
    
[0m05:05:25.382225 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.383477 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: Close
[0m05:05:25.384049 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d1bd3a30>]}
[0m05:05:25.384708 [info ] [Thread-1 (]: 7 of 11 OK created sql view model main.stg_fbref__shooting ..................... [[32mOK[0m in 0.03s]
[0m05:05:25.385442 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__shooting
[0m05:05:25.385883 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__standard
[0m05:05:25.386542 [info ] [Thread-1 (]: 8 of 11 START sql view model main.stg_fbref__standard .......................... [RUN]
[0m05:05:25.387207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__shooting, now model.nextgeneu_players.stg_fbref__standard)
[0m05:05:25.387768 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__standard
[0m05:05:25.397369 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.397999 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__standard
[0m05:05:25.401784 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.402390 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.402746 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: BEGIN
[0m05:05:25.403076 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.403825 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.404212 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.404648 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

  
  create view "players"."main"."stg_fbref__standard__dbt_tmp" as (
    -- 1. CONFIGURATION


WITH raw_union AS (
    
        SELECT 
            *, 
            '2023_2024' as source_season_id 
        FROM "players"."raw"."standard_stats_2023_2024"
         UNION ALL 
    
        SELECT 
            *, 
            '2024_2025' as source_season_id 
        FROM "players"."raw"."standard_stats_2024_2025"
         UNION ALL 
    
        SELECT 
            *, 
            '2025_2026' as source_season_id 
        FROM "players"."raw"."standard_stats_2025_2026"
        
    
),

cleaned AS (
    SELECT
        -- 1. IDENTITY (The Golden Key)
        
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
        
        -- 2. METADATA
        unnamed_1_level_0_player as player_name,
        unnamed_2_level_0_nation as nation,
        unnamed_4_level_0_squad  as squad,
        unnamed_3_level_0_pos    as primary_position,
        unnamed_5_level_0_comp   as competition,
        source_season_id         as season_id,
        
        -- 3. DEMOGRAPHICS
        
    TRY_CAST(SPLIT_PART(unnamed_6_level_0_age, '-', 1) AS INTEGER)
 as age,
        
    TRY_CAST(REPLACE(unnamed_7_level_0_born, ',', '') AS INTEGER)
 as birth_year,

        -- 4. PLAYING TIME
        
    TRY_CAST(REPLACE(playing_time_mp, ',', '') AS INTEGER)
 as matches_played,
        
    TRY_CAST(REPLACE(playing_time_starts, ',', '') AS INTEGER)
 as matches_started,
        
    TRY_CAST(REPLACE(playing_time_min, ',', '') AS INTEGER)
 as minutes_played,
        TRY_CAST(playing_time_90s AS FLOAT) as minutes_90s,

        -- 5. PERFORMANCE METRICS (Using the macro to handle commas/types)
        
    TRY_CAST(REPLACE(performance_gls, ',', '') AS INTEGER)
 as goals,
        
    TRY_CAST(REPLACE(performance_ast, ',', '') AS INTEGER)
 as assists,
        
    TRY_CAST(REPLACE(performance_ga, ',', '') AS INTEGER)
 as goals_assists,
        
    TRY_CAST(REPLACE(performance_pk, ',', '') AS INTEGER)
 as penalties_made,
        
    TRY_CAST(REPLACE(performance_pkatt, ',', '') AS INTEGER)
 as penalties_att,
        
        -- 6. EXPECTED METRICS
        TRY_CAST(expected_xg AS FLOAT) as xg,
        TRY_CAST(expected_npxg AS FLOAT) as npxg,
        TRY_CAST(expected_xag AS FLOAT) as xag,
        
        -- 7. PROGRESSION
        
    TRY_CAST(REPLACE(progression_prgc, ',', '') AS INTEGER)
 as progressive_carries,
        
    TRY_CAST(REPLACE(progression_prgp, ',', '') AS INTEGER)
 as progressive_passes,
        
    TRY_CAST(REPLACE(progression_prgr, ',', '') AS INTEGER)
 as progressive_receptions

    FROM raw_union
)

SELECT * FROM cleaned
WHERE player_name != 'Player' -- Filter header rows
  AND player_name IS NOT NULL
  );

[0m05:05:25.407124 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.411477 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.411851 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */
alter view "players"."main"."stg_fbref__standard" rename to "stg_fbref__standard__dbt_backup"
[0m05:05:25.412572 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.415545 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.415916 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */
alter view "players"."main"."stg_fbref__standard__dbt_tmp" rename to "stg_fbref__standard"
[0m05:05:25.416606 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.417821 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m05:05:25.418208 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.418546 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m05:05:25.421949 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m05:05:25.425399 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:05:25.425824 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

      drop view if exists "players"."main"."stg_fbref__standard__dbt_backup" cascade
    
[0m05:05:25.427727 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.429054 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: Close
[0m05:05:25.429698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d1c69bd0>]}
[0m05:05:25.430371 [info ] [Thread-1 (]: 8 of 11 OK created sql view model main.stg_fbref__standard ..................... [[32mOK[0m in 0.04s]
[0m05:05:25.431119 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__standard
[0m05:05:25.431919 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.int_player_season_stats
[0m05:05:25.432530 [info ] [Thread-1 (]: 9 of 11 START sql view model main.int_player_season_stats ...................... [RUN]
[0m05:05:25.433076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__standard, now model.nextgeneu_players.int_player_season_stats)
[0m05:05:25.433491 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.int_player_season_stats
[0m05:05:25.437950 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.438595 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.int_player_season_stats
[0m05:05:25.442380 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.443019 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.443495 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: BEGIN
[0m05:05:25.443926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.444667 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.445057 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.445530 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */

  
  create view "players"."main"."int_player_season_stats__dbt_tmp" as (
    WITH standard AS (SELECT * FROM "players"."main"."stg_fbref__standard"),
     shooting AS (SELECT * FROM "players"."main"."stg_fbref__shooting"),
     passing  AS (SELECT * FROM "players"."main"."stg_fbref__passing"),
     defense  AS (SELECT * FROM "players"."main"."stg_fbref__defense"),
     poss     AS (SELECT * FROM "players"."main"."stg_fbref__possession"),
     misc     AS (SELECT * FROM "players"."main"."stg_fbref__misc")

SELECT
    -- Anchors
    s.player_id,
    s.player_name,
    s.season_id,
    s.squad,
    s.competition,
    s.nation,
    s.primary_position,
    s.age,
    s.birth_year,
    s.minutes_90s,

    -- Attacking Metrics
    s.goals,
    s.assists,
    s.npxg,
    s.xag,
    coalesce(sh.shots_total, 0) as shots_total,
    coalesce(sh.shots_on_target, 0) as shots_on_target,

    -- Possession & Creation
    coalesce(p.key_passes, 0) as key_passes,
    coalesce(p.pass_progressive_distance, 0) as pass_progressive_distance,
    coalesce(poss.carry_progressive_distance, 0) as carry_progressive_distance,
    coalesce(poss.takeons_won, 0) as takeons_won,

    -- Defensive Workrate
    coalesce(d.tackles_won, 0) as tackles_won,
    coalesce(d.interceptions, 0) as interceptions,
    coalesce(d.tackles_att_3rd, 0) as tackles_att_3rd,
    coalesce(m.ball_recoveries, 0) as recoveries,
    coalesce(m.aerials_won, 0) as aerials_won

FROM standard s
LEFT JOIN shooting sh USING (player_id, squad, season_id)
LEFT JOIN passing p   USING (player_id, squad, season_id)
LEFT JOIN defense d   USING (player_id, squad, season_id)
LEFT JOIN poss        USING (player_id, squad, season_id)
LEFT JOIN misc m      USING (player_id, squad, season_id)

-- Filter out rows where the join keys might have drifted or empty names
WHERE s.player_id IS NOT NULL
  );

[0m05:05:25.453066 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m05:05:25.456284 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.456691 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */
alter view "players"."main"."int_player_season_stats" rename to "int_player_season_stats__dbt_backup"
[0m05:05:25.457407 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.461555 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.461959 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */
alter view "players"."main"."int_player_season_stats__dbt_tmp" rename to "int_player_season_stats"
[0m05:05:25.462658 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.463882 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: COMMIT
[0m05:05:25.464294 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.464667 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: COMMIT
[0m05:05:25.467263 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.469944 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:05:25.470368 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */

      drop view if exists "players"."main"."int_player_season_stats__dbt_backup" cascade
    
[0m05:05:25.472209 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.473916 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: Close
[0m05:05:25.474548 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d04e29e0>]}
[0m05:05:25.475176 [info ] [Thread-1 (]: 9 of 11 OK created sql view model main.int_player_season_stats ................. [[32mOK[0m in 0.04s]
[0m05:05:25.475845 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.int_player_season_stats
[0m05:05:25.476647 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.dim_players
[0m05:05:25.477146 [info ] [Thread-1 (]: 10 of 11 START sql table model main.dim_players ................................ [RUN]
[0m05:05:25.477653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.int_player_season_stats, now model.nextgeneu_players.dim_players)
[0m05:05:25.478026 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.dim_players
[0m05:05:25.480918 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.dim_players"
[0m05:05:25.481490 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.dim_players
[0m05:05:25.502068 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.dim_players"
[0m05:05:25.502733 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.503142 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: BEGIN
[0m05:05:25.503508 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.504308 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.504689 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.505074 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

  
    
    

    create  table
      "players"."main"."dim_players__dbt_tmp"
  
    as (
      WITH unique_players AS (
    SELECT 
        player_id,
        -- Get the most recently used name (in case it changed)
        arg_max(player_name, season_id) as player_name,
        -- Get the most recent nation/position
        arg_max(nation, season_id) as nation,
        arg_max(primary_position, season_id) as primary_position,
        max(birth_year) as birth_year
    FROM "players"."main"."int_player_season_stats"
    GROUP BY player_id
)

SELECT * FROM unique_players
    );
  
  
[0m05:05:25.547899 [debug] [Thread-1 (]: SQL status: OK in 0.042 seconds
[0m05:05:25.554040 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.554520 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_players'
  
[0m05:05:25.555544 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.556803 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.557208 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_players'
  
[0m05:05:25.558154 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.561853 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.562280 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */
alter table "players"."main"."dim_players" rename to "dim_players__dbt_backup"
[0m05:05:25.563039 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.567647 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.568019 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */
alter table "players"."main"."dim_players__dbt_tmp" rename to "dim_players"
[0m05:05:25.568684 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.573239 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: COMMIT
[0m05:05:25.573612 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.573944 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: COMMIT
[0m05:05:25.580264 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m05:05:25.583118 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:05:25.583514 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

      drop table if exists "players"."main"."dim_players__dbt_backup" cascade
    
[0m05:05:25.585273 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.586731 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: Close
[0m05:05:25.587380 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d9b6c9d0>]}
[0m05:05:25.588100 [info ] [Thread-1 (]: 10 of 11 OK created sql table model main.dim_players ........................... [[32mOK[0m in 0.11s]
[0m05:05:25.588995 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.dim_players
[0m05:05:25.589468 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.mart_scouting_analysis
[0m05:05:25.590022 [info ] [Thread-1 (]: 11 of 11 START sql table model main.mart_scouting_analysis ..................... [RUN]
[0m05:05:25.590547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.dim_players, now model.nextgeneu_players.mart_scouting_analysis)
[0m05:05:25.590930 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.mart_scouting_analysis
[0m05:05:25.599923 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.600678 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.mart_scouting_analysis
[0m05:05:25.605604 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.606741 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.607441 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: BEGIN
[0m05:05:25.607848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:05:25.608714 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.609277 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.609738 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

  
    
    

    create  table
      "players"."main"."mart_scouting_analysis__dbt_tmp"
  
    as (
      WITH base_stats AS (
    SELECT * FROM "players"."main"."int_player_season_stats"
    WHERE minutes_90s >= 5.0 -- Filter: Remove noise (players with < 5 games)
),

per_90_calculations AS (
    SELECT 
        *,
        -- 1. ATTACK SCORES
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE goals + assists / minutes_90s
    END
 as goal_contribution_per_90,
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE npxg + xag / minutes_90s
    END
 as expected_contribution_per_90,
        
        -- 2. PROGRESSION SCORES (The "Engine" Metric)
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE pass_progressive_distance + carry_progressive_distance / minutes_90s
    END
 as progression_total_dist_per_90,
        
        -- 3. DEFENSIVE SCORES (The "Workrate" Metric)
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE tackles_won + interceptions + recoveries / minutes_90s
    END
 as defensive_actions_per_90,
        
        -- 4. FLAGS
        CASE WHEN (2026 - birth_year) <= 23 THEN TRUE ELSE FALSE END as is_u23_prospect
    FROM base_stats
)

SELECT 
    *,
    -- Percentile Ranks (0.0 to 1.0)
    -- Compare players only against peers in the SAME position and SAME season
    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY expected_contribution_per_90 ASC
    ) as percentile_attacking,

    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY progression_total_dist_per_90 ASC
    ) as percentile_progression,

    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY defensive_actions_per_90 ASC
    ) as percentile_defense

FROM per_90_calculations
    );
  
  
[0m05:05:25.659735 [debug] [Thread-1 (]: SQL status: OK in 0.049 seconds
[0m05:05:25.661182 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.661643 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'mart_scouting_analysis'
  
[0m05:05:25.662657 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.663931 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.664364 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'mart_scouting_analysis'
  
[0m05:05:25.665265 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:05:25.668842 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.669259 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */
alter table "players"."main"."mart_scouting_analysis" rename to "mart_scouting_analysis__dbt_backup"
[0m05:05:25.669951 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.674269 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.674676 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */
alter table "players"."main"."mart_scouting_analysis__dbt_tmp" rename to "mart_scouting_analysis"
[0m05:05:25.675430 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:05:25.676838 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: COMMIT
[0m05:05:25.677283 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.677679 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: COMMIT
[0m05:05:25.695656 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m05:05:25.699676 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:05:25.700148 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

      drop table if exists "players"."main"."mart_scouting_analysis__dbt_backup" cascade
    
[0m05:05:25.702283 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:05:25.703871 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: Close
[0m05:05:25.704570 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f790f71-a1c4-4d61-b51d-08843c30139b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d04eada0>]}
[0m05:05:25.705386 [info ] [Thread-1 (]: 11 of 11 OK created sql table model main.mart_scouting_analysis ................ [[32mOK[0m in 0.11s]
[0m05:05:25.706404 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.mart_scouting_analysis
[0m05:05:25.707726 [debug] [MainThread]: Using duckdb connection "master"
[0m05:05:25.708116 [debug] [MainThread]: On master: BEGIN
[0m05:05:25.708462 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m05:05:25.709300 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m05:05:25.709672 [debug] [MainThread]: On master: COMMIT
[0m05:05:25.710037 [debug] [MainThread]: Using duckdb connection "master"
[0m05:05:25.710422 [debug] [MainThread]: On master: COMMIT
[0m05:05:25.711059 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m05:05:25.711478 [debug] [MainThread]: On master: Close
[0m05:05:25.711964 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:05:25.712334 [debug] [MainThread]: Connection 'model.nextgeneu_players.mart_scouting_analysis' was properly closed.
[0m05:05:25.712872 [info ] [MainThread]: 
[0m05:05:25.713559 [info ] [MainThread]: Finished running 2 table models, 9 view models in 0 hours 0 minutes and 0.88 seconds (0.88s).
[0m05:05:25.716942 [debug] [MainThread]: Command end result
[0m05:05:25.764567 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m05:05:25.767128 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m05:05:25.775281 [debug] [MainThread]: Wrote artifact RunExecutionResult to /app/transformation/target/run_results.json
[0m05:05:25.775610 [info ] [MainThread]: 
[0m05:05:25.776151 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:05:25.776598 [info ] [MainThread]: 
[0m05:05:25.776993 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=11
[0m05:05:25.778436 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.0765824, "process_in_blocks": "8408", "process_kernel_time": 0.296881, "process_mem_max_rss": "350544", "process_out_blocks": "7448", "process_user_time": 3.698527}
[0m05:05:25.778884 [debug] [MainThread]: Command `dbt build` succeeded at 05:05:25.778780 after 2.08 seconds
[0m05:05:25.779274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546dabf8670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d3267790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546daa9f490>]}
[0m05:05:25.779670 [debug] [MainThread]: Flushing usage events
[0m05:05:26.283140 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:06:41.902742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364c4d86d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364b39e7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364b39f9d0>]}


============================== 05:06:41.907757 | 5332c602-6510-4640-8425-be13ca8f0a4d ==============================
[0m05:06:41.907757 [info ] [MainThread]: Running with dbt=1.10.15
[0m05:06:41.908407 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'log_path': '/app/transformation/logs', 'version_check': 'True', 'debug': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'profiles_dir': '/app/transformation', 'use_colors': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'empty': 'False', 'no_print': 'None', 'static_parser': 'True', 'log_cache_events': 'False', 'introspect': 'True', 'invocation_command': 'dbt build'}
[0m05:06:42.155971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364e4763e0>]}
[0m05:06:42.226142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364b362bc0>]}
[0m05:06:42.228111 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m05:06:42.320368 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m05:06:42.446332 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:06:42.447134 [debug] [MainThread]: Partial parsing: updated file: nextgeneu_players://models/intermediate/int_player_season_stats.sql
[0m05:06:42.787329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3644254130>]}
[0m05:06:42.890982 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m05:06:42.892848 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m05:06:42.920747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c36442a8700>]}
[0m05:06:42.921268 [info ] [MainThread]: Found 11 models, 33 sources, 586 macros
[0m05:06:42.924448 [info ] [MainThread]: 
[0m05:06:42.924933 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:06:42.925332 [info ] [MainThread]: 
[0m05:06:42.925944 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m05:06:42.932969 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_players'
[0m05:06:42.969471 [debug] [ThreadPool]: Using duckdb connection "list_players"
[0m05:06:42.969891 [debug] [ThreadPool]: On list_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"players"'
    
  
  
[0m05:06:42.970238 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:06:42.998995 [debug] [ThreadPool]: SQL status: OK in 0.029 seconds
[0m05:06:43.000932 [debug] [ThreadPool]: On list_players: Close
[0m05:06:43.001823 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_players, now create_players_main)
[0m05:06:43.002321 [debug] [ThreadPool]: Creating schema "database: "players"
schema: "main"
"
[0m05:06:43.009678 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:06:43.010013 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='players'
        and type='sqlite'
    
  
[0m05:06:43.010337 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:06:43.011331 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m05:06:43.012697 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:06:43.013027 [debug] [ThreadPool]: On create_players_main: BEGIN
[0m05:06:43.013559 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m05:06:43.013884 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:06:43.014303 [debug] [ThreadPool]: On create_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "create_players_main"} */

    
    
        create schema if not exists "players"."main"
    
[0m05:06:43.015054 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m05:06:43.016045 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m05:06:43.016379 [debug] [ThreadPool]: Using duckdb connection "create_players_main"
[0m05:06:43.016660 [debug] [ThreadPool]: On create_players_main: COMMIT
[0m05:06:43.017188 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m05:06:43.017499 [debug] [ThreadPool]: On create_players_main: Close
[0m05:06:43.019245 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_players_main, now list_players_main)
[0m05:06:43.024990 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m05:06:43.025362 [debug] [ThreadPool]: On list_players_main: BEGIN
[0m05:06:43.025665 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:06:43.026327 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m05:06:43.026659 [debug] [ThreadPool]: Using duckdb connection "list_players_main"
[0m05:06:43.026993 [debug] [ThreadPool]: On list_players_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "connection_name": "list_players_main"} */
select
      'players' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'players'
  
[0m05:06:43.040047 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m05:06:43.041466 [debug] [ThreadPool]: On list_players_main: ROLLBACK
[0m05:06:43.042015 [debug] [ThreadPool]: Failed to rollback 'list_players_main'
[0m05:06:43.042375 [debug] [ThreadPool]: On list_players_main: Close
[0m05:06:43.044707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3644bfe2c0>]}
[0m05:06:43.045211 [debug] [MainThread]: Using duckdb connection "master"
[0m05:06:43.045538 [debug] [MainThread]: On master: BEGIN
[0m05:06:43.045839 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:06:43.046459 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m05:06:43.046794 [debug] [MainThread]: On master: COMMIT
[0m05:06:43.047142 [debug] [MainThread]: Using duckdb connection "master"
[0m05:06:43.047454 [debug] [MainThread]: On master: COMMIT
[0m05:06:43.048003 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m05:06:43.048382 [debug] [MainThread]: On master: Close
[0m05:06:43.051573 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__creation
[0m05:06:43.052131 [info ] [Thread-1 (]: 1 of 11 START sql view model main.stg_fbref__creation .......................... [RUN]
[0m05:06:43.052674 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_players_main, now model.nextgeneu_players.stg_fbref__creation)
[0m05:06:43.053135 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__creation
[0m05:06:43.067057 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.067868 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__creation
[0m05:06:43.097878 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.098639 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.099017 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: BEGIN
[0m05:06:43.099407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.100286 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.100663 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.101051 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */

  
  create view "players"."main"."stg_fbref__creation__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."goal_and_shot_creation_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(sca_sca, ',', '') AS INTEGER)
 as shot_creating_actions,
    
    TRY_CAST(REPLACE(gca_gca, ',', '') AS INTEGER)
 as goal_creating_actions

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:06:43.102657 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.109110 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.109506 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */
alter view "players"."main"."stg_fbref__creation" rename to "stg_fbref__creation__dbt_backup"
[0m05:06:43.110222 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.113243 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.113630 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */
alter view "players"."main"."stg_fbref__creation__dbt_tmp" rename to "stg_fbref__creation"
[0m05:06:43.114311 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.125730 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: COMMIT
[0m05:06:43.126143 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.126502 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: COMMIT
[0m05:06:43.143697 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m05:06:43.150711 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__creation"
[0m05:06:43.151135 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__creation"} */

      drop view if exists "players"."main"."stg_fbref__creation__dbt_backup" cascade
    
[0m05:06:43.153054 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.155636 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__creation: Close
[0m05:06:43.157375 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c363f45ca00>]}
[0m05:06:43.158030 [info ] [Thread-1 (]: 1 of 11 OK created sql view model main.stg_fbref__creation ..................... [[32mOK[0m in 0.10s]
[0m05:06:43.158743 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__creation
[0m05:06:43.159204 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__defense
[0m05:06:43.159758 [info ] [Thread-1 (]: 2 of 11 START sql view model main.stg_fbref__defense ........................... [RUN]
[0m05:06:43.160340 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__creation, now model.nextgeneu_players.stg_fbref__defense)
[0m05:06:43.160774 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__defense
[0m05:06:43.167414 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.168001 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__defense
[0m05:06:43.171528 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.172146 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.172513 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: BEGIN
[0m05:06:43.172834 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.173586 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.173958 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.174355 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */

  
  create view "players"."main"."stg_fbref__defense__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."defensive_actions_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."defensive_actions_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."defensive_actions_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(tackles_tkl, ',', '') AS INTEGER)
 as tackles_total,
    
    TRY_CAST(REPLACE(tackles_tklw, ',', '') AS INTEGER)
 as tackles_won,
    
    TRY_CAST(REPLACE(tackles_att_3rd, ',', '') AS INTEGER)
 as tackles_att_3rd,
    
    TRY_CAST(REPLACE(unnamed_21_level_0_int, ',', '') AS INTEGER)
 as interceptions,
    
    TRY_CAST(REPLACE(unnamed_23_level_0_clr, ',', '') AS INTEGER)
 as clearances,
    
    TRY_CAST(REPLACE(blocks_sh, ',', '') AS INTEGER)
 as shots_blocked

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:06:43.176003 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.179200 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.179567 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */
alter view "players"."main"."stg_fbref__defense" rename to "stg_fbref__defense__dbt_backup"
[0m05:06:43.180231 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.183203 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.183567 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */
alter view "players"."main"."stg_fbref__defense__dbt_tmp" rename to "stg_fbref__defense"
[0m05:06:43.184315 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.185526 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: COMMIT
[0m05:06:43.185885 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.186249 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: COMMIT
[0m05:06:43.188690 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.191836 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__defense"
[0m05:06:43.192280 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__defense"} */

      drop view if exists "players"."main"."stg_fbref__defense__dbt_backup" cascade
    
[0m05:06:43.194149 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.195402 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__defense: Close
[0m05:06:43.196008 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c36453b6290>]}
[0m05:06:43.196667 [info ] [Thread-1 (]: 2 of 11 OK created sql view model main.stg_fbref__defense ...................... [[32mOK[0m in 0.04s]
[0m05:06:43.197322 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__defense
[0m05:06:43.197734 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__misc
[0m05:06:43.198278 [info ] [Thread-1 (]: 3 of 11 START sql view model main.stg_fbref__misc .............................. [RUN]
[0m05:06:43.198764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__defense, now model.nextgeneu_players.stg_fbref__misc)
[0m05:06:43.199160 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__misc
[0m05:06:43.206430 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.207030 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__misc
[0m05:06:43.210410 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.211030 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.211431 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: BEGIN
[0m05:06:43.211783 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.212459 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.212852 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.213284 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */

  
  create view "players"."main"."stg_fbref__misc__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."miscellaneous_stats_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."miscellaneous_stats_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."miscellaneous_stats_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(performance_crdy, ',', '') AS INTEGER)
 as yellow_cards,
    
    TRY_CAST(REPLACE(performance_crdr, ',', '') AS INTEGER)
 as red_cards,
    
    TRY_CAST(REPLACE(performance_fls, ',', '') AS INTEGER)
 as fouls_committed,
    
    TRY_CAST(REPLACE(performance_fld, ',', '') AS INTEGER)
 as fouls_drawn,
    
    TRY_CAST(REPLACE(performance_off, ',', '') AS INTEGER)
 as offsides,
    
    TRY_CAST(REPLACE(performance_recov, ',', '') AS INTEGER)
 as ball_recoveries,
    
    TRY_CAST(REPLACE(aerial_duels_won, ',', '') AS INTEGER)
 as aerials_won,
    
    TRY_CAST(REPLACE(aerial_duels_lost, ',', '') AS INTEGER)
 as aerials_lost

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:06:43.214904 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.217995 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.218405 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */
alter view "players"."main"."stg_fbref__misc" rename to "stg_fbref__misc__dbt_backup"
[0m05:06:43.219108 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.222014 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.222418 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */
alter view "players"."main"."stg_fbref__misc__dbt_tmp" rename to "stg_fbref__misc"
[0m05:06:43.223071 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.224299 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: COMMIT
[0m05:06:43.224680 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.225033 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: COMMIT
[0m05:06:43.227474 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.229955 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__misc"
[0m05:06:43.230368 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__misc"} */

      drop view if exists "players"."main"."stg_fbref__misc__dbt_backup" cascade
    
[0m05:06:43.232170 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.233433 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__misc: Close
[0m05:06:43.234039 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c36453b6290>]}
[0m05:06:43.234701 [info ] [Thread-1 (]: 3 of 11 OK created sql view model main.stg_fbref__misc ......................... [[32mOK[0m in 0.04s]
[0m05:06:43.235430 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__misc
[0m05:06:43.235912 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__passing
[0m05:06:43.236594 [info ] [Thread-1 (]: 4 of 11 START sql view model main.stg_fbref__passing ........................... [RUN]
[0m05:06:43.237186 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__misc, now model.nextgeneu_players.stg_fbref__passing)
[0m05:06:43.237651 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__passing
[0m05:06:43.244778 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.245440 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__passing
[0m05:06:43.248926 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.249577 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.249967 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: BEGIN
[0m05:06:43.250367 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.251182 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.251569 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.251983 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */

  
  create view "players"."main"."stg_fbref__passing__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."passing_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."passing_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."passing_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(total_cmp, ',', '') AS INTEGER)
 as passes_completed,
    
    TRY_CAST(REPLACE(total_att, ',', '') AS INTEGER)
 as passes_attempted,
    
    TRY_CAST(REPLACE(total_prgdist, ',', '') AS INTEGER)
 as pass_progressive_distance,
    
    TRY_CAST(REPLACE(unnamed_27_level_0_kp, ',', '') AS INTEGER)
 as key_passes,
    
    TRY_CAST(REPLACE(unnamed_29_level_0_ppa, ',', '') AS INTEGER)
 as passes_into_penalty_area,
    
    TRY_CAST(REPLACE(unnamed_30_level_0_crspa, ',', '') AS INTEGER)
 as crosses_into_penalty_area

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:06:43.253775 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.257007 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.257496 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */
alter view "players"."main"."stg_fbref__passing" rename to "stg_fbref__passing__dbt_backup"
[0m05:06:43.258259 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.261608 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.262024 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */
alter view "players"."main"."stg_fbref__passing__dbt_tmp" rename to "stg_fbref__passing"
[0m05:06:43.262790 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.264073 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: COMMIT
[0m05:06:43.264500 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.264869 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: COMMIT
[0m05:06:43.267273 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.269889 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__passing"
[0m05:06:43.270302 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__passing"} */

      drop view if exists "players"."main"."stg_fbref__passing__dbt_backup" cascade
    
[0m05:06:43.272595 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.273866 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__passing: Close
[0m05:06:43.274492 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c363f45dcf0>]}
[0m05:06:43.275150 [info ] [Thread-1 (]: 4 of 11 OK created sql view model main.stg_fbref__passing ...................... [[32mOK[0m in 0.04s]
[0m05:06:43.275790 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__passing
[0m05:06:43.276231 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__playing_time
[0m05:06:43.276800 [info ] [Thread-1 (]: 5 of 11 START sql view model main.stg_fbref__playing_time ...................... [RUN]
[0m05:06:43.277316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__passing, now model.nextgeneu_players.stg_fbref__playing_time)
[0m05:06:43.277681 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__playing_time
[0m05:06:43.283412 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.284029 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__playing_time
[0m05:06:43.344913 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.345743 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.346134 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: BEGIN
[0m05:06:43.346478 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.347320 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.347686 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.348115 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */

  
  create view "players"."main"."stg_fbref__playing_time__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."playing_time_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."playing_time_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."playing_time_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_1_level_0_player as player_name,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(playing_time_mp, ',', '') AS INTEGER)
 as matches_played,
    
    TRY_CAST(REPLACE(starts_starts, ',', '') AS INTEGER)
 as starts,
    
    TRY_CAST(REPLACE(subs_subs, ',', '') AS INTEGER)
 as substitutions_on,
    
    TRY_CAST(REPLACE(subs_unsub, ',', '') AS INTEGER)
 as unused_sub,
    
    -- Team Success (Plus/Minus)
    TRY_CAST(team_success_onoff AS FLOAT) as plus_minus_net_per_90

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:06:43.349831 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.353199 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.353594 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */
alter view "players"."main"."stg_fbref__playing_time" rename to "stg_fbref__playing_time__dbt_backup"
[0m05:06:43.354282 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.357263 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.357656 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */
alter view "players"."main"."stg_fbref__playing_time__dbt_tmp" rename to "stg_fbref__playing_time"
[0m05:06:43.358328 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.359560 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: COMMIT
[0m05:06:43.359952 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.360346 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: COMMIT
[0m05:06:43.362794 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.365339 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__playing_time"
[0m05:06:43.365707 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__playing_time"} */

      drop view if exists "players"."main"."stg_fbref__playing_time__dbt_backup" cascade
    
[0m05:06:43.367317 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.369124 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__playing_time: Close
[0m05:06:43.369728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364d7aa0e0>]}
[0m05:06:43.370438 [info ] [Thread-1 (]: 5 of 11 OK created sql view model main.stg_fbref__playing_time ................. [[32mOK[0m in 0.09s]
[0m05:06:43.371377 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__playing_time
[0m05:06:43.371986 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__possession
[0m05:06:43.372591 [info ] [Thread-1 (]: 6 of 11 START sql view model main.stg_fbref__possession ........................ [RUN]
[0m05:06:43.373118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__playing_time, now model.nextgeneu_players.stg_fbref__possession)
[0m05:06:43.373512 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__possession
[0m05:06:43.379677 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.380320 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__possession
[0m05:06:43.385049 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.385681 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.386095 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: BEGIN
[0m05:06:43.386469 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.387243 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.387642 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.388072 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */

  
  create view "players"."main"."stg_fbref__possession__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."possession_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."possession_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."possession_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(touches_touches, ',', '') AS INTEGER)
 as touches,
    
    TRY_CAST(REPLACE(touches_att_pen, ',', '') AS INTEGER)
 as touches_att_pen,
    
    TRY_CAST(REPLACE(takeons_succ, ',', '') AS INTEGER)
 as takeons_won,
    
    TRY_CAST(REPLACE(takeons_att, ',', '') AS INTEGER)
 as takeons_attempted,
    
    TRY_CAST(REPLACE(carries_prgdist, ',', '') AS INTEGER)
 as carry_progressive_distance,
    
    TRY_CAST(REPLACE(carries_cpa, ',', '') AS INTEGER)
 as carries_into_penalty_area

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:06:43.389734 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.392866 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.393289 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */
alter view "players"."main"."stg_fbref__possession" rename to "stg_fbref__possession__dbt_backup"
[0m05:06:43.393985 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.396926 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.397348 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */
alter view "players"."main"."stg_fbref__possession__dbt_tmp" rename to "stg_fbref__possession"
[0m05:06:43.398013 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.399269 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: COMMIT
[0m05:06:43.399671 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.400044 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: COMMIT
[0m05:06:43.402534 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.405059 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__possession"
[0m05:06:43.405479 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__possession"} */

      drop view if exists "players"."main"."stg_fbref__possession__dbt_backup" cascade
    
[0m05:06:43.407325 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.408571 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__possession: Close
[0m05:06:43.409197 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c36442a2110>]}
[0m05:06:43.409850 [info ] [Thread-1 (]: 6 of 11 OK created sql view model main.stg_fbref__possession ................... [[32mOK[0m in 0.04s]
[0m05:06:43.410615 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__possession
[0m05:06:43.411035 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__shooting
[0m05:06:43.411760 [info ] [Thread-1 (]: 7 of 11 START sql view model main.stg_fbref__shooting .......................... [RUN]
[0m05:06:43.412395 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__possession, now model.nextgeneu_players.stg_fbref__shooting)
[0m05:06:43.412855 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__shooting
[0m05:06:43.418599 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.419234 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__shooting
[0m05:06:43.422699 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.423321 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.423711 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: BEGIN
[0m05:06:43.424063 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.424780 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.425174 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.425585 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */

  
  create view "players"."main"."stg_fbref__shooting__dbt_tmp" as (
    

WITH raw_union AS (
    
        SELECT *, '2023_2024' as source_season_id FROM "players"."raw"."shooting_2023_2024"
         UNION ALL 
    
        SELECT *, '2024_2025' as source_season_id FROM "players"."raw"."shooting_2024_2025"
         UNION ALL 
    
        SELECT *, '2025_2026' as source_season_id FROM "players"."raw"."shooting_2025_2026"
        
    
)

SELECT
    
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
    unnamed_4_level_0_squad  as squad,
    source_season_id         as season_id,
    
    
    TRY_CAST(REPLACE(standard_sh, ',', '') AS INTEGER)
 as shots_total,
    
    TRY_CAST(REPLACE(standard_sot, ',', '') AS INTEGER)
 as shots_on_target,
    TRY_CAST(standard_dist AS FLOAT) as avg_shot_distance

FROM raw_union
WHERE unnamed_1_level_0_player != 'Player'
  );

[0m05:06:43.427026 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.431339 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.431817 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */
alter view "players"."main"."stg_fbref__shooting" rename to "stg_fbref__shooting__dbt_backup"
[0m05:06:43.432525 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.435459 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.435856 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */
alter view "players"."main"."stg_fbref__shooting__dbt_tmp" rename to "stg_fbref__shooting"
[0m05:06:43.436526 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.437737 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: COMMIT
[0m05:06:43.438147 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.438512 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: COMMIT
[0m05:06:43.440862 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.443467 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__shooting"
[0m05:06:43.443850 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__shooting"} */

      drop view if exists "players"."main"."stg_fbref__shooting__dbt_backup" cascade
    
[0m05:06:43.445715 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.446983 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__shooting: Close
[0m05:06:43.447614 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c363f47d690>]}
[0m05:06:43.448261 [info ] [Thread-1 (]: 7 of 11 OK created sql view model main.stg_fbref__shooting ..................... [[32mOK[0m in 0.04s]
[0m05:06:43.448955 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__shooting
[0m05:06:43.449421 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.stg_fbref__standard
[0m05:06:43.449988 [info ] [Thread-1 (]: 8 of 11 START sql view model main.stg_fbref__standard .......................... [RUN]
[0m05:06:43.450606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__shooting, now model.nextgeneu_players.stg_fbref__standard)
[0m05:06:43.451060 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.stg_fbref__standard
[0m05:06:43.459498 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.460096 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.stg_fbref__standard
[0m05:06:43.463919 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.464540 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.464996 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: BEGIN
[0m05:06:43.465417 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.466227 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.466631 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.467276 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

  
  create view "players"."main"."stg_fbref__standard__dbt_tmp" as (
    -- 1. CONFIGURATION


WITH raw_union AS (
    
        SELECT 
            *, 
            '2023_2024' as source_season_id 
        FROM "players"."raw"."standard_stats_2023_2024"
         UNION ALL 
    
        SELECT 
            *, 
            '2024_2025' as source_season_id 
        FROM "players"."raw"."standard_stats_2024_2025"
         UNION ALL 
    
        SELECT 
            *, 
            '2025_2026' as source_season_id 
        FROM "players"."raw"."standard_stats_2025_2026"
        
    
),

cleaned AS (
    SELECT
        -- 1. IDENTITY (The Golden Key)
        
    md5(concat(
        coalesce(unnamed_1_level_0_player, ''), 
        '-', 
        coalesce(unnamed_7_level_0_born, ''), 
        '-', 
        coalesce(unnamed_2_level_0_nation, '')
    ))
 as player_id,
        
        -- 2. METADATA
        unnamed_1_level_0_player as player_name,
        unnamed_2_level_0_nation as nation,
        unnamed_4_level_0_squad  as squad,
        unnamed_3_level_0_pos    as primary_position,
        unnamed_5_level_0_comp   as competition,
        source_season_id         as season_id,
        
        -- 3. DEMOGRAPHICS
        
    TRY_CAST(SPLIT_PART(unnamed_6_level_0_age, '-', 1) AS INTEGER)
 as age,
        
    TRY_CAST(REPLACE(unnamed_7_level_0_born, ',', '') AS INTEGER)
 as birth_year,

        -- 4. PLAYING TIME
        
    TRY_CAST(REPLACE(playing_time_mp, ',', '') AS INTEGER)
 as matches_played,
        
    TRY_CAST(REPLACE(playing_time_starts, ',', '') AS INTEGER)
 as matches_started,
        
    TRY_CAST(REPLACE(playing_time_min, ',', '') AS INTEGER)
 as minutes_played,
        TRY_CAST(playing_time_90s AS FLOAT) as minutes_90s,

        -- 5. PERFORMANCE METRICS (Using the macro to handle commas/types)
        
    TRY_CAST(REPLACE(performance_gls, ',', '') AS INTEGER)
 as goals,
        
    TRY_CAST(REPLACE(performance_ast, ',', '') AS INTEGER)
 as assists,
        
    TRY_CAST(REPLACE(performance_ga, ',', '') AS INTEGER)
 as goals_assists,
        
    TRY_CAST(REPLACE(performance_pk, ',', '') AS INTEGER)
 as penalties_made,
        
    TRY_CAST(REPLACE(performance_pkatt, ',', '') AS INTEGER)
 as penalties_att,
        
        -- 6. EXPECTED METRICS
        TRY_CAST(expected_xg AS FLOAT) as xg,
        TRY_CAST(expected_npxg AS FLOAT) as npxg,
        TRY_CAST(expected_xag AS FLOAT) as xag,
        
        -- 7. PROGRESSION
        
    TRY_CAST(REPLACE(progression_prgc, ',', '') AS INTEGER)
 as progressive_carries,
        
    TRY_CAST(REPLACE(progression_prgp, ',', '') AS INTEGER)
 as progressive_passes,
        
    TRY_CAST(REPLACE(progression_prgr, ',', '') AS INTEGER)
 as progressive_receptions

    FROM raw_union
)

SELECT * FROM cleaned
WHERE player_name != 'Player' -- Filter header rows
  AND player_name IS NOT NULL
  );

[0m05:06:43.470796 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m05:06:43.477357 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.477808 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */
alter view "players"."main"."stg_fbref__standard" rename to "stg_fbref__standard__dbt_backup"
[0m05:06:43.478927 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.483058 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.483624 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */
alter view "players"."main"."stg_fbref__standard__dbt_tmp" rename to "stg_fbref__standard"
[0m05:06:43.484734 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.486406 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m05:06:43.486951 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.487471 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: COMMIT
[0m05:06:43.490672 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m05:06:43.494406 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.stg_fbref__standard"
[0m05:06:43.494781 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.stg_fbref__standard"} */

      drop view if exists "players"."main"."stg_fbref__standard__dbt_backup" cascade
    
[0m05:06:43.496846 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.498293 [debug] [Thread-1 (]: On model.nextgeneu_players.stg_fbref__standard: Close
[0m05:06:43.498917 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c363f47d690>]}
[0m05:06:43.499577 [info ] [Thread-1 (]: 8 of 11 OK created sql view model main.stg_fbref__standard ..................... [[32mOK[0m in 0.05s]
[0m05:06:43.500272 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.stg_fbref__standard
[0m05:06:43.501161 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.int_player_season_stats
[0m05:06:43.501658 [info ] [Thread-1 (]: 9 of 11 START sql view model main.int_player_season_stats ...................... [RUN]
[0m05:06:43.502199 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.stg_fbref__standard, now model.nextgeneu_players.int_player_season_stats)
[0m05:06:43.502591 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.int_player_season_stats
[0m05:06:43.508678 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.509460 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.int_player_season_stats
[0m05:06:43.514003 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.514637 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.515001 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: BEGIN
[0m05:06:43.515355 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.516153 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.516513 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.516902 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */

  
  create view "players"."main"."int_player_season_stats__dbt_tmp" as (
    WITH standard AS (SELECT * FROM "players"."main"."stg_fbref__standard"),
     shooting AS (SELECT * FROM "players"."main"."stg_fbref__shooting"),
     passing  AS (SELECT * FROM "players"."main"."stg_fbref__passing"),
     defense  AS (SELECT * FROM "players"."main"."stg_fbref__defense"),
     poss     AS (SELECT * FROM "players"."main"."stg_fbref__possession"),
     misc     AS (SELECT * FROM "players"."main"."stg_fbref__misc")

SELECT
    -- Anchors
    s.player_id,
    s.player_name,
    s.season_id,
    s.squad,
    s.competition,
    s.nation,
    s.primary_position,
    s.age,
    s.birth_year,
    s.minutes_played,
    s.minutes_90s,

    -- Attacking Metrics
    s.goals,
    s.assists,
    s.npxg,
    s.xag,
    coalesce(sh.shots_total, 0) as shots_total,
    coalesce(sh.shots_on_target, 0) as shots_on_target,

    -- Possession & Creation
    coalesce(p.key_passes, 0) as key_passes,
    coalesce(p.pass_progressive_distance, 0) as pass_progressive_distance,
    coalesce(poss.carry_progressive_distance, 0) as carry_progressive_distance,
    coalesce(poss.takeons_won, 0) as takeons_won,

    -- Defensive Workrate
    coalesce(d.tackles_won, 0) as tackles_won,
    coalesce(d.interceptions, 0) as interceptions,
    coalesce(d.tackles_att_3rd, 0) as tackles_att_3rd,
    coalesce(m.ball_recoveries, 0) as recoveries,
    coalesce(m.aerials_won, 0) as aerials_won

FROM standard s
LEFT JOIN shooting sh USING (player_id, squad, season_id)
LEFT JOIN passing p   USING (player_id, squad, season_id)
LEFT JOIN defense d   USING (player_id, squad, season_id)
LEFT JOIN poss        USING (player_id, squad, season_id)
LEFT JOIN misc m      USING (player_id, squad, season_id)

-- Filter out rows where the join keys might have drifted or empty names
WHERE s.player_id IS NOT NULL
  );

[0m05:06:43.524454 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m05:06:43.527967 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.528354 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */
alter view "players"."main"."int_player_season_stats" rename to "int_player_season_stats__dbt_backup"
[0m05:06:43.529041 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.533393 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.533763 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */
alter view "players"."main"."int_player_season_stats__dbt_tmp" rename to "int_player_season_stats"
[0m05:06:43.534504 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.535935 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: COMMIT
[0m05:06:43.536353 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.536715 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: COMMIT
[0m05:06:43.539715 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m05:06:43.542342 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.int_player_season_stats"
[0m05:06:43.542757 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.int_player_season_stats"} */

      drop view if exists "players"."main"."int_player_season_stats__dbt_backup" cascade
    
[0m05:06:43.544352 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.545662 [debug] [Thread-1 (]: On model.nextgeneu_players.int_player_season_stats: Close
[0m05:06:43.546317 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364bc734f0>]}
[0m05:06:43.546973 [info ] [Thread-1 (]: 9 of 11 OK created sql view model main.int_player_season_stats ................. [[32mOK[0m in 0.04s]
[0m05:06:43.547711 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.int_player_season_stats
[0m05:06:43.548576 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.dim_players
[0m05:06:43.549074 [info ] [Thread-1 (]: 10 of 11 START sql table model main.dim_players ................................ [RUN]
[0m05:06:43.549637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.int_player_season_stats, now model.nextgeneu_players.dim_players)
[0m05:06:43.550024 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.dim_players
[0m05:06:43.553124 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.dim_players"
[0m05:06:43.553737 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.dim_players
[0m05:06:43.573628 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.dim_players"
[0m05:06:43.574281 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.574643 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: BEGIN
[0m05:06:43.574968 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.575763 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.576146 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.576536 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

  
    
    

    create  table
      "players"."main"."dim_players__dbt_tmp"
  
    as (
      WITH unique_players AS (
    SELECT 
        player_id,
        -- Get the most recently used name (in case it changed)
        arg_max(player_name, season_id) as player_name,
        -- Get the most recent nation/position
        arg_max(nation, season_id) as nation,
        arg_max(primary_position, season_id) as primary_position,
        max(birth_year) as birth_year
    FROM "players"."main"."int_player_season_stats"
    GROUP BY player_id
)

SELECT * FROM unique_players
    );
  
  
[0m05:06:43.611669 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m05:06:43.617734 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.618187 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_players'
  
[0m05:06:43.619150 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.620369 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.620730 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'dim_players'
  
[0m05:06:43.621615 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.625202 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.625564 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */
alter table "players"."main"."dim_players" rename to "dim_players__dbt_backup"
[0m05:06:43.626220 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.630479 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.630929 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */
alter table "players"."main"."dim_players__dbt_tmp" rename to "dim_players"
[0m05:06:43.631702 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.637169 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: COMMIT
[0m05:06:43.637570 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.637987 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: COMMIT
[0m05:06:43.643986 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m05:06:43.646745 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.dim_players"
[0m05:06:43.647189 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.dim_players"} */

      drop table if exists "players"."main"."dim_players__dbt_backup" cascade
    
[0m05:06:43.649112 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.650439 [debug] [Thread-1 (]: On model.nextgeneu_players.dim_players: Close
[0m05:06:43.651069 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3644bff760>]}
[0m05:06:43.651747 [info ] [Thread-1 (]: 10 of 11 OK created sql table model main.dim_players ........................... [[32mOK[0m in 0.10s]
[0m05:06:43.652423 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.dim_players
[0m05:06:43.652847 [debug] [Thread-1 (]: Began running node model.nextgeneu_players.mart_scouting_analysis
[0m05:06:43.653419 [info ] [Thread-1 (]: 11 of 11 START sql table model main.mart_scouting_analysis ..................... [RUN]
[0m05:06:43.653925 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.nextgeneu_players.dim_players, now model.nextgeneu_players.mart_scouting_analysis)
[0m05:06:43.654341 [debug] [Thread-1 (]: Began compiling node model.nextgeneu_players.mart_scouting_analysis
[0m05:06:43.659923 [debug] [Thread-1 (]: Writing injected SQL for node "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.660648 [debug] [Thread-1 (]: Began executing node model.nextgeneu_players.mart_scouting_analysis
[0m05:06:43.664254 [debug] [Thread-1 (]: Writing runtime sql for node "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.664865 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.665276 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: BEGIN
[0m05:06:43.665647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:06:43.666357 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.666757 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.667335 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

  
    
    

    create  table
      "players"."main"."mart_scouting_analysis__dbt_tmp"
  
    as (
      WITH base_stats AS (
    SELECT * FROM "players"."main"."int_player_season_stats"
    WHERE minutes_90s >= 5.0 -- Filter: Remove noise (players with < 5 games)
),

per_90_calculations AS (
    SELECT 
        *,
        -- 1. ATTACK SCORES
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE goals + assists / minutes_90s
    END
 as goal_contribution_per_90,
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE npxg + xag / minutes_90s
    END
 as expected_contribution_per_90,
        
        -- 2. PROGRESSION SCORES (The "Engine" Metric)
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE pass_progressive_distance + carry_progressive_distance / minutes_90s
    END
 as progression_total_dist_per_90,
        
        -- 3. DEFENSIVE SCORES (The "Workrate" Metric)
        
    CASE 
        WHEN minutes_90s = 0 OR minutes_90s IS NULL THEN 0
        ELSE tackles_won + interceptions + recoveries / minutes_90s
    END
 as defensive_actions_per_90,
        
        -- 4. FLAGS
        CASE WHEN (2026 - birth_year) <= 23 THEN TRUE ELSE FALSE END as is_u23_prospect
    FROM base_stats
)

SELECT 
    *,
    -- Percentile Ranks (0.0 to 1.0)
    -- Compare players only against peers in the SAME position and SAME season
    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY expected_contribution_per_90 ASC
    ) as percentile_attacking,

    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY progression_total_dist_per_90 ASC
    ) as percentile_progression,

    PERCENT_RANK() OVER (
        PARTITION BY season_id, primary_position 
        ORDER BY defensive_actions_per_90 ASC
    ) as percentile_defense

FROM per_90_calculations
    );
  
  
[0m05:06:43.720607 [debug] [Thread-1 (]: SQL status: OK in 0.052 seconds
[0m05:06:43.722145 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.722636 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'mart_scouting_analysis'
  
[0m05:06:43.723643 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.724950 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.725386 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'main'
      AND table_name = 'mart_scouting_analysis'
  
[0m05:06:43.726372 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m05:06:43.730170 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.730584 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */
alter table "players"."main"."mart_scouting_analysis" rename to "mart_scouting_analysis__dbt_backup"
[0m05:06:43.731319 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.736000 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.736424 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */
alter table "players"."main"."mart_scouting_analysis__dbt_tmp" rename to "mart_scouting_analysis"
[0m05:06:43.737135 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m05:06:43.738483 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: COMMIT
[0m05:06:43.738888 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.739283 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: COMMIT
[0m05:06:43.759209 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m05:06:43.763877 [debug] [Thread-1 (]: Using duckdb connection "model.nextgeneu_players.mart_scouting_analysis"
[0m05:06:43.764453 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "nextgeneu_players", "target_name": "dev", "node_id": "model.nextgeneu_players.mart_scouting_analysis"} */

      drop table if exists "players"."main"."mart_scouting_analysis__dbt_backup" cascade
    
[0m05:06:43.767022 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m05:06:43.768920 [debug] [Thread-1 (]: On model.nextgeneu_players.mart_scouting_analysis: Close
[0m05:06:43.769759 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5332c602-6510-4640-8425-be13ca8f0a4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364e058070>]}
[0m05:06:43.770644 [info ] [Thread-1 (]: 11 of 11 OK created sql table model main.mart_scouting_analysis ................ [[32mOK[0m in 0.12s]
[0m05:06:43.771439 [debug] [Thread-1 (]: Finished running node model.nextgeneu_players.mart_scouting_analysis
[0m05:06:43.773316 [debug] [MainThread]: Using duckdb connection "master"
[0m05:06:43.773697 [debug] [MainThread]: On master: BEGIN
[0m05:06:43.774044 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m05:06:43.774811 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m05:06:43.775194 [debug] [MainThread]: On master: COMMIT
[0m05:06:43.775558 [debug] [MainThread]: Using duckdb connection "master"
[0m05:06:43.775876 [debug] [MainThread]: On master: COMMIT
[0m05:06:43.776446 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m05:06:43.776803 [debug] [MainThread]: On master: Close
[0m05:06:43.777256 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:06:43.777554 [debug] [MainThread]: Connection 'model.nextgeneu_players.mart_scouting_analysis' was properly closed.
[0m05:06:43.778126 [info ] [MainThread]: 
[0m05:06:43.778690 [info ] [MainThread]: Finished running 2 table models, 9 view models in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m05:06:43.781385 [debug] [MainThread]: Command end result
[0m05:06:43.819841 [debug] [MainThread]: Wrote artifact WritableManifest to /app/transformation/target/manifest.json
[0m05:06:43.821649 [debug] [MainThread]: Wrote artifact SemanticManifest to /app/transformation/target/semantic_manifest.json
[0m05:06:43.828826 [debug] [MainThread]: Wrote artifact RunExecutionResult to /app/transformation/target/run_results.json
[0m05:06:43.829167 [info ] [MainThread]: 
[0m05:06:43.829623 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:06:43.830004 [info ] [MainThread]: 
[0m05:06:43.830452 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=11
[0m05:06:43.831524 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.9895985, "process_in_blocks": "0", "process_kernel_time": 0.27991, "process_mem_max_rss": "332644", "process_out_blocks": "7480", "process_user_time": 3.590676}
[0m05:06:43.832028 [debug] [MainThread]: Command `dbt build` succeeded at 05:06:43.831922 after 1.99 seconds
[0m05:06:43.832433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364c4d86d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3644b94a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c364e4763e0>]}
[0m05:06:43.832829 [debug] [MainThread]: Flushing usage events
[0m05:06:44.321496 [debug] [MainThread]: An error was encountered while trying to flush usage events
